<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>南青山プリズムビル - 投資レポート</title>
    
    <!-- 共通CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">
    
    <!-- PDF専用スタイル -->
    <style>
        /* PDF生成専用レイアウト */
        @media print, screen {
            /* 基本設定 */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                font-family: 'Helvetica Neue', Arial, 'Hiragino Sans', 'Yu Gothic', sans-serif;
                margin: 0;
                padding: 0;
                background: white;
                color: #333;
                line-height: 1.6;
            }
            
            /* ページコンテナ */
            .pdf-container {
                width: 210mm;
                margin: 0 auto;
                background: white;
            }
            
            /* 表紙 */
            .cover-page {
                page-break-after: always;
                height: 297mm;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
                color: white;
                text-align: center;
                position: relative;
            }
            
            .cover-logo {
                width: 200px;
                height: auto;
                margin-bottom: 40px;
                filter: brightness(0) invert(1);
            }
            
            .cover-title {
                font-size: 36pt;
                font-weight: 700;
                letter-spacing: 0.05em;
                margin-bottom: 20px;
            }
            
            .cover-subtitle {
                font-size: 18pt;
                font-weight: 300;
                opacity: 0.9;
                margin-bottom: 60px;
            }
            
            .cover-date {
                position: absolute;
                bottom: 50px;
                font-size: 12pt;
                opacity: 0.8;
            }
            
            /* セクション */
            .pdf-section {
                padding: 30mm 20mm;
                page-break-inside: avoid;
            }
            
            .section-header {
                background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
                color: white;
                margin: -30mm -20mm 20mm;
                padding: 15mm 20mm;
            }
            
            .section-title {
                font-size: 24pt;
                font-weight: 600;
                margin: 0;
            }
            
            .section-subtitle {
                font-size: 12pt;
                opacity: 0.9;
                margin-top: 5mm;
            }
            
            /* コンテンツ */
            .content-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15mm;
                margin: 20mm 0;
            }
            
            .info-block {
                background: #f8f9fa;
                border-left: 4px solid #2c5282;
                padding: 10mm;
            }
            
            .info-label {
                font-size: 10pt;
                color: #666;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                margin-bottom: 3mm;
            }
            
            .info-value {
                font-size: 18pt;
                font-weight: 600;
                color: #1a365d;
            }
            
            .info-unit {
                font-size: 11pt;
                color: #666;
                font-weight: 400;
            }
            
            /* テーブル */
            .pdf-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15mm 0;
                font-size: 10pt;
            }
            
            .pdf-table thead {
                background: #2c5282;
                color: white;
            }
            
            .pdf-table th,
            .pdf-table td {
                padding: 8mm 10mm;
                text-align: left;
                border: 1px solid #dee2e6;
            }
            
            .pdf-table tbody tr:nth-child(even) {
                background: #f8f9fa;
            }
            
            .pdf-table .number {
                text-align: right;
                font-family: 'Courier New', monospace;
            }
            
            /* グラフコンテナ */
            .chart-container {
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15mm;
                margin: 20mm 0;
                page-break-inside: avoid;
            }
            
            .chart-title {
                font-size: 14pt;
                font-weight: 600;
                color: #1a365d;
                margin-bottom: 10mm;
                text-align: center;
            }
            
            /* 物件画像 */
            .property-images {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10mm;
                margin: 20mm 0;
            }
            
            .property-image {
                width: 100%;
                height: auto;
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            /* ハイライトボックス */
            .highlight-box {
                background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
                border: 2px solid #2c5282;
                border-radius: 8px;
                padding: 15mm;
                margin: 20mm 0;
                page-break-inside: avoid;
            }
            
            .highlight-title {
                font-size: 16pt;
                font-weight: 600;
                color: #1a365d;
                margin-bottom: 8mm;
            }
            
            .highlight-content {
                font-size: 11pt;
                line-height: 1.8;
            }
            
            /* フッター情報 */
            .pdf-footer {
                margin-top: 30mm;
                padding-top: 10mm;
                border-top: 2px solid #dee2e6;
                text-align: center;
                color: #666;
                font-size: 9pt;
            }
            
            /* 改ページ制御 */
            .page-break {
                page-break-after: always;
            }
            
            .avoid-break {
                page-break-inside: avoid;
            }
            
            /* 非表示要素（PDF生成時） */
            .no-print {
                display: none !important;
            }
        }
        
        /* スクリーン表示用の調整 */
        @media screen {
            body {
                background: #f5f7fa;
                padding: 20px;
            }
            
            .pdf-container {
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }
            
            .cover-page {
                min-height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="pdf-container">
        <!-- 表紙 -->
        <div class="cover-page">
            <img src="/assets/images/logo.svg" alt="PRISM" class="cover-logo">
            <h1 class="cover-title">南青山プリズムビル</h1>
            <p class="cover-subtitle">完全投資分析レポート</p>
            <div class="cover-date" id="reportDate"></div>
        </div>
        
        <!-- エグゼクティブサマリー -->
        <div class="pdf-section">
            <div class="section-header">
                <h2 class="section-title">エグゼクティブサマリー</h2>
                <p class="section-subtitle">投資判断のための重要指標</p>
            </div>
            
            <div class="content-grid">
                <div class="info-block">
                    <div class="info-label">想定利回り</div>
                    <div class="info-value">4.2<span class="info-unit">%</span></div>
                </div>
                <div class="info-block">
                    <div class="info-label">物件価格</div>
                    <div class="info-value">32<span class="info-unit">億円</span></div>
                </div>
                <div class="info-block">
                    <div class="info-label">NOI利回り</div>
                    <div class="info-value">3.8<span class="info-unit">%</span></div>
                </div>
                <div class="info-block">
                    <div class="info-label">稼働率</div>
                    <div class="info-value">95<span class="info-unit">%</span></div>
                </div>
            </div>
            
            <div class="highlight-box">
                <h3 class="highlight-title">投資ポイント</h3>
                <div class="highlight-content">
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>南青山の一等地に位置する希少性の高い物件</li>
                        <li>安定した賃料収入と高い稼働率を維持</li>
                        <li>大手優良テナントによる長期契約</li>
                        <li>将来的な資産価値上昇が期待できるエリア</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 物件概要 -->
        <div class="pdf-section page-break">
            <div class="section-header">
                <h2 class="section-title">物件概要</h2>
                <p class="section-subtitle">基本情報と立地特性</p>
            </div>
            
            <table class="pdf-table">
                <tbody>
                    <tr>
                        <td style="width: 30%; font-weight: 600;">所在地</td>
                        <td>東京都港区南青山3-1-3</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">交通アクセス</td>
                        <td>東京メトロ銀座線「外苑前」駅 徒歩2分</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">竣工年月</td>
                        <td>2018年3月</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">構造・規模</td>
                        <td>鉄骨鉄筋コンクリート造 地上10階・地下2階</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">延床面積</td>
                        <td>8,234.56㎡</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">賃貸可能面積</td>
                        <td>6,543.21㎡</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">基準階面積</td>
                        <td>約650㎡</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">駐車場</td>
                        <td>35台</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="property-images">
                <img src="/assets/images/minamiaoyama1.jpg" alt="物件外観" class="property-image">
                <img src="/assets/images/minamiaoyama2.jpg" alt="エントランス" class="property-image">
            </div>
        </div>
        
        <!-- 財務分析 -->
        <div class="pdf-section page-break">
            <div class="section-header">
                <h2 class="section-title">財務分析</h2>
                <p class="section-subtitle">収支計画と投資指標</p>
            </div>
            
            <h3 style="color: #1a365d; margin-top: 20mm;">年間収支計画</h3>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th>項目</th>
                        <th class="number">金額（千円）</th>
                        <th class="number">構成比</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>賃料収入</td>
                        <td class="number">134,400</td>
                        <td class="number">100.0%</td>
                    </tr>
                    <tr>
                        <td>運営費用</td>
                        <td class="number">-26,880</td>
                        <td class="number">20.0%</td>
                    </tr>
                    <tr>
                        <td>NOI（営業純収益）</td>
                        <td class="number" style="font-weight: 600;">107,520</td>
                        <td class="number" style="font-weight: 600;">80.0%</td>
                    </tr>
                    <tr>
                        <td>資本的支出</td>
                        <td class="number">-5,376</td>
                        <td class="number">4.0%</td>
                    </tr>
                    <tr>
                        <td>NCF（純収益）</td>
                        <td class="number" style="font-weight: 600; color: #2c5282;">102,144</td>
                        <td class="number" style="font-weight: 600;">76.0%</td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="color: #1a365d; margin-top: 20mm;">投資指標分析</h3>
            <div class="content-grid">
                <div class="chart-container">
                    <h4 class="chart-title">キャップレート推移</h4>
                    <canvas id="capRateChart" width="400" height="250"></canvas>
                </div>
                <div class="chart-container">
                    <h4 class="chart-title">IRR感度分析</h4>
                    <canvas id="irrChart" width="400" height="250"></canvas>
                </div>
            </div>
        </div>
        
        <!-- 25年返済計画 -->
        <div class="pdf-section page-break">
            <div class="section-header">
                <h2 class="section-title">25年返済計画</h2>
                <p class="section-subtitle">融資条件と返済スケジュール</p>
            </div>
            
            <div class="info-block" style="margin-bottom: 15mm;">
                <h3 style="color: #1a365d; margin: 0 0 10mm 0;">融資条件</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 5mm;">
                    <div>借入金額: <strong>22.4億円</strong></div>
                    <div>金利: <strong>1.2%（固定）</strong></div>
                    <div>返済期間: <strong>25年</strong></div>
                    <div>返済方式: <strong>元利均等</strong></div>
                </div>
            </div>
            
            <table class="pdf-table" style="font-size: 9pt;">
                <thead>
                    <tr>
                        <th>年</th>
                        <th class="number">年間返済額</th>
                        <th class="number">元金返済</th>
                        <th class="number">利息支払</th>
                        <th class="number">残元金</th>
                    </tr>
                </thead>
                <tbody id="loanSchedule">
                    <!-- JavaScriptで動的生成 -->
                </tbody>
            </table>
        </div>
        
        <!-- リスク分析 -->
        <div class="pdf-section page-break">
            <div class="section-header">
                <h2 class="section-title">リスク分析</h2>
                <p class="section-subtitle">主要リスクと対策</p>
            </div>
            
            <div class="highlight-box">
                <h3 class="highlight-title">マーケットリスク</h3>
                <div class="highlight-content">
                    <p>賃料下落リスク: <strong>低</strong></p>
                    <p>南青山エリアの強固な需要と希少性により、賃料の安定性は高い。</p>
                </div>
            </div>
            
            <div class="highlight-box">
                <h3 class="highlight-title">テナントリスク</h3>
                <div class="highlight-content">
                    <p>退去リスク: <strong>中</strong></p>
                    <p>大手優良企業中心のテナント構成。平均契約期間5年以上。</p>
                </div>
            </div>
            
            <div class="highlight-box">
                <h3 class="highlight-title">物理的リスク</h3>
                <div class="highlight-content">
                    <p>災害リスク: <strong>低</strong></p>
                    <p>最新の耐震基準に準拠。BCP対応設備完備。</p>
                </div>
            </div>
        </div>
        
        <!-- 総合評価 -->
        <div class="pdf-section">
            <div class="section-header">
                <h2 class="section-title">総合評価</h2>
                <p class="section-subtitle">投資推奨レベル</p>
            </div>
            
            <div style="text-align: center; margin: 30mm 0;">
                <div style="font-size: 48pt; font-weight: 700; color: #2c5282; margin-bottom: 10mm;">
                    ★★★★☆
                </div>
                <div style="font-size: 18pt; font-weight: 600; color: #1a365d;">
                    推奨レベル: 高
                </div>
            </div>
            
            <div class="highlight-box">
                <h3 class="highlight-title">投資推奨理由</h3>
                <div class="highlight-content">
                    <ol style="margin: 0; padding-left: 20px;">
                        <li>プライムロケーションによる資産価値の安定性</li>
                        <li>優良テナントによる安定収益</li>
                        <li>適正な価格設定とバリューアップ余地</li>
                        <li>中長期的な資産価値上昇期待</li>
                        <li>ESG対応による将来性</li>
                    </ol>
                </div>
            </div>
            
            <div class="pdf-footer">
                <p>本レポートは投資判断の参考資料であり、投資勧誘を目的としたものではありません。</p>
                <p>PRISM VIP © 2024 All Rights Reserved.</p>
            </div>
        </div>
    </div>
    
    <!-- Chart.js（グラフ描画用） -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // レポート日付設定
        document.getElementById('reportDate').textContent = 
            `作成日: ${new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}`;
        
        // 25年返済スケジュール生成
        function generateLoanSchedule() {
            const principal = 2240000000; // 22.4億円
            const annualRate = 0.012; // 1.2%
            const years = 25;
            const monthlyRate = annualRate / 12;
            const totalMonths = years * 12;
            
            // 月額返済額計算
            const monthlyPayment = principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths) 
                / (Math.pow(1 + monthlyRate, totalMonths) - 1);
            const annualPayment = monthlyPayment * 12;
            
            let balance = principal;
            const schedule = [];
            
            for (let year = 1; year <= years; year++) {
                let yearPrincipal = 0;
                let yearInterest = 0;
                
                for (let month = 1; month <= 12; month++) {
                    const interest = balance * monthlyRate;
                    const principalPayment = monthlyPayment - interest;
                    
                    yearInterest += interest;
                    yearPrincipal += principalPayment;
                    balance -= principalPayment;
                    
                    if (balance < 0) balance = 0;
                }
                
                schedule.push({
                    year,
                    payment: annualPayment,
                    principal: yearPrincipal,
                    interest: yearInterest,
                    balance: balance
                });
            }
            
            return schedule;
        }
        
        // テーブルにデータを挿入
        const schedule = generateLoanSchedule();
        const tbody = document.getElementById('loanSchedule');
        
        // 最初の10年と最後の5年を表示
        const displayYears = [...schedule.slice(0, 10), ...schedule.slice(-5)];
        
        displayYears.forEach((row, index) => {
            if (index === 10 && schedule.length > 15) {
                // 省略行を追加
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="5" style="text-align: center; color: #666;">... 中略 ...</td>';
                tbody.appendChild(tr);
            }
            
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.year}年目</td>
                <td class="number">${(row.payment / 1000000).toFixed(1)}百万円</td>
                <td class="number">${(row.principal / 1000000).toFixed(1)}百万円</td>
                <td class="number">${(row.interest / 1000000).toFixed(1)}百万円</td>
                <td class="number">${(row.balance / 1000000).toFixed(0)}百万円</td>
            `;
            tbody.appendChild(tr);
        });
        
        // グラフ描画（PDFモードでは簡略化）
        if (typeof Chart !== 'undefined') {
            // キャップレート推移グラフ
            const capRateCtx = document.getElementById('capRateChart');
            if (capRateCtx) {
                new Chart(capRateCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
                        datasets: [{
                            label: '南青山エリア',
                            data: [3.8, 3.9, 3.7, 3.6, 3.5, 3.4],
                            borderColor: '#2c5282',
                            backgroundColor: 'rgba(44, 82, 130, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: value => value + '%'
                                }
                            }
                        }
                    }
                });
            }
            
            // IRR感度分析グラフ
            const irrCtx = document.getElementById('irrChart');
            if (irrCtx) {
                new Chart(irrCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['悲観', '標準', '楽観'],
                        datasets: [{
                            label: 'IRR',
                            data: [5.2, 7.8, 10.5],
                            backgroundColor: ['#e53e3e', '#2c5282', '#38a169']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => value + '%'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // URLパラメータからステージを取得
        const urlParams = new URLSearchParams(window.location.search);
        const stage = parseInt(urlParams.get('stage')) || 5;
        const docType = urlParams.get('type') || 'complete';
        
        // ステージに応じてコンテンツを調整
        if (stage < 5) {
            // ステージに応じて一部セクションを非表示
            const sections = document.querySelectorAll('.pdf-section');
            if (stage < 4) sections[sections.length - 1].style.display = 'none'; // 総合評価
            if (stage < 3) sections[sections.length - 2].style.display = 'none'; // リスク分析
            if (stage < 2) sections[3].style.display = 'none'; // 25年返済計画
        }
    </script>
</body>
</html>