<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ« - æŠ•è³‡å®¶å‘ã‘æ®µéšçš„ææ¡ˆã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="/assets/css/common.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .member-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow-sm);
        }

        .member-header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .member-name {
            font-weight: 600;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            height: 30px;
        }

        .logo img {
            height: 100%;
            width: auto;
            filter: brightness(0) invert(1);
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .breadcrumb {
            padding: 20px 0;
            font-size: 0.9em;
            color: var(--gray-500);
        }

        .breadcrumb a {
            color: var(--primary-light);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* æ®µéšçš„ææ¡ˆã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’common.cssãƒ™ãƒ¼ã‚¹ã§èª¿æ•´ */
        .stage-indicator {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            border-top: 3px solid var(--primary-light);
        }

        .stage-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stage-item {
            flex: 1;
            text-align: center;
            position: relative;
            padding: 10px;
        }

        .stage-item:not(:last-child):after {
            content: '';
            position: absolute;
            top: 35px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: var(--gray-100);
            z-index: 0;
        }

        .stage-item.completed:not(:last-child):after {
            background: var(--success);
        }

        .stage-circle {
            width: 60px;
            height: 60px;
            background: var(--gray-100);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3em;
            color: var(--gray-300);
            position: relative;
            z-index: 1;
            border-radius: 50%;
        }

        .stage-item.completed .stage-circle {
            background: var(--success);
            color: white;
        }

        .stage-item.current .stage-circle {
            background: var(--primary-light);
            color: white;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
        }

        .stage-label {
            font-size: 0.875rem;
            color: var(--gray-500);
            font-weight: 600;
        }

        .stage-item.completed .stage-label {
            color: var(--success);
        }

        .stage-item.current .stage-label {
            color: var(--primary-light);
        }

        .nav-tabs {
            display: flex;
            background: white;
            box-shadow: var(--shadow-sm);
            overflow-x: auto;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 20px 30px;
            background: white;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-500);
            white-space: nowrap;
            transition: all 0.2s ease;
            flex-shrink: 0;
            position: relative;
        }

        .nav-tab.locked {
            background: var(--gray-50);
            color: var(--gray-200);
            cursor: not-allowed;
            position: relative;
        }

        .nav-tab.locked:after {
            content: 'ğŸ”’';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
        }

        .nav-tab:not(.locked):hover {
            background: var(--gray-50);
        }

        .nav-tab.active {
            color: var(--primary-dark);
            border-bottom: 3px solid var(--primary-light);
            background: var(--primary-lighter);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            background: white;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            border-top: 3px solid var(--primary-light);
        }

        .locked-overlay {
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border: 2px dashed var(--gray-200);
        }

        .locked-content {
            text-align: center;
            padding: 40px;
        }

        .locked-icon {
            font-size: 4em;
            color: var(--gray-200);
            margin-bottom: 20px;
        }

        .locked-title {
            font-size: 1.5em;
            color: var(--gray-500);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .locked-description {
            color: var(--gray-400);
            margin-bottom: 20px;
        }

        .unlock-button {
            background: var(--primary-black);
            color: white;
            padding: 12px 30px;
            border: none;
            font-weight: 600;
            letter-spacing: 0.03em;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            text-decoration: none;
            border-radius: 0;
        }

        .unlock-button:hover {
            background: #1a1a1a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .subsection-title {
            color: var(--primary-dark);
            font-size: 1.5em;
            margin: 25px 0 15px;
            font-weight: 600;
            border-left: 4px solid var(--primary-light);
            padding-left: 15px;
        }

        .property-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-box {
            background: var(--gray-50);
            padding: 20px;
            border-left: 4px solid var(--primary-light);
        }

        .info-box h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-box p {
            color: var(--gray-500);
            margin: 5px 0;
        }

        .highlight-number {
            font-size: 2.5em;
            color: var(--primary-dark);
            font-weight: 700;
            display: block;
            margin: 10px 0;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border-top: 3px solid var(--primary-light);
        }

        .kpi-label {
            color: var(--gray-400);
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            margin-bottom: 10px;
        }

        .kpi-value {
            color: var(--primary-dark);
            font-size: 2.5em;
            font-weight: 700;
        }

        .kpi-unit {
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-top: 5px;
        }

        .stage-description {
            background: var(--primary-lighter);
            padding: 20px;
            margin-top: 20px;
        }

        .stage-description h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .action-buttons {
            text-align: center;
            padding: 30px;
            background: var(--gray-50);
            margin-top: 30px;
        }

        .specs-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: var(--shadow-sm);
            margin: 20px 0;
        }

        .specs-table thead {
            background: linear-gradient(to bottom, #edf2f7, #e2e8f0);
        }

        .specs-table th {
            color: var(--gray-600);
            font-weight: 600;
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid var(--gray-200);
            letter-spacing: 0.03em;
        }

        .specs-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-100);
            color: var(--gray-500);
        }

        .specs-table tr:hover {
            background: var(--gray-50);
            transition: background 0.2s;
        }
        
        /* ã‚¹ãƒ”ãƒŠãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆPDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .member-header {
                padding: 15px 0;
            }

            .member-header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 0 15px;
            }

            .member-info {
                gap: 10px;
                font-size: 0.9em;
            }

            .btn-logout {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            /* ç®¡ç†è€…ãƒ‘ãƒãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
            #adminPanel {
                width: calc(100vw - 30px) !important;
                right: 15px !important;
                left: 15px !important;
                top: 140px !important;
                max-height: 60vh !important;
            }

            /* ãƒ‘ãƒ³ããšãƒŠãƒ“ */
            .breadcrumb {
                font-size: 0.9em;
                margin-bottom: 20px;
            }

            /* ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
            .stage-indicator {
                margin-bottom: 20px;
            }

            .stage-indicator h2 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .stage-progress {
                flex-direction: row;
                gap: 5px;
                overflow-x: auto;
                padding: 10px 0;
            }

            .stage-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 5px;
                padding: 10px;
                background: white;
                border-radius: 10px;
                box-shadow: var(--shadow-sm);
                min-width: 60px;
                flex-shrink: 0;
            }

            .stage-item:not(:last-child):after {
                display: none;
            }

            .stage-circle {
                width: 36px;
                height: 36px;
                line-height: 36px;
                font-size: 1em;
                flex-shrink: 0;
            }

            .stage-label {
                font-size: 0.7em;
                font-weight: 600;
                text-align: center;
            }

            /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
                margin-bottom: 20px;
            }

            .nav-tab {
                padding: 15px 20px;
                font-size: 0.95em;
                text-align: left;
                border-radius: 8px;
            }

            .nav-tab.locked {
                opacity: 0.5;
                background: var(--gray-100);
                padding: 12px 20px;
            }

            /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */
            .section-card {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .section-title {
                font-size: 1.4em;
                margin-bottom: 15px;
            }

            .subsection-title {
                font-size: 1.1em;
                margin: 20px 0 10px;
            }

            /* KPIã‚°ãƒªãƒƒãƒ‰ */
            .kpi-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .kpi-card {
                padding: 15px;
            }

            .kpi-value {
                font-size: 1.8em;
            }

            /* ç‰©ä»¶æ¦‚è¦ */
            .property-overview {
                flex-direction: column;
                gap: 15px;
            }

            .info-box {
                padding: 15px;
            }

            .highlight-number {
                font-size: 1.6em;
            }

            /* ãƒ­ãƒƒã‚¯ç”»é¢ */
            .locked-overlay {
                padding: 30px 20px;
            }

            .locked-content {
                max-width: none;
            }

            .locked-icon {
                font-size: 3em;
                margin-bottom: 15px;
            }

            .locked-title {
                font-size: 1.3em;
                margin-bottom: 10px;
            }

            .locked-description {
                font-size: 0.95em;
                margin-bottom: 20px;
                line-height: 1.6;
            }

            /* ãƒœã‚¿ãƒ³ */
            .btn {
                padding: 12px 24px;
                font-size: 0.95em;
            }

            .unlock-button {
                padding: 12px 24px;
                font-size: 0.95em;
            }

            .action-buttons {
                margin-top: 20px;
            }

            .action-buttons .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            /* ãƒãƒ£ãƒ¼ãƒˆãƒ»ã‚°ãƒ©ãƒ•ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
            .chart-container {
                overflow-x: auto;
                margin: 15px 0;
            }

            /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
            table {
                font-size: 0.9em;
                width: 100%;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            /* ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´ */
            body {
                font-size: 16px;
                line-height: 1.6;
            }

            p {
                line-height: 1.7;
            }
        }
    </style>
</head>
<body>
    <!-- ä¼šå“¡ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="member-header">
        <div class="member-header-content">
            <div class="logo">
                <img src="/assets/images/logo/prism-logo-optimized.svg" alt="PRISM">
            </div>
            <div class="member-info">
                <span class="member-name" id="memberName">VIPä¼šå“¡æ§˜</span>
                <button id="adminToggle" onclick="toggleAdminMode()" class="btn-logout" style="margin-right: 10px;"><span class="material-icons" style="vertical-align: middle; margin-right: 5px; font-size: 18px;">settings</span>ç®¡ç†è€…</button>
                <a href="/" class="btn-logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            </div>
        </div>
    </header>

    <!-- ç®¡ç†è€…ãƒ‘ãƒãƒ«èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="adminOverlay" onclick="closeAdminPanel()" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;"></div>
    
    <!-- ç®¡ç†è€…ãƒ‘ãƒãƒ« -->
    <div id="adminPanel" style="display: none; position: fixed; top: 80px; right: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); width: 320px; z-index: 1000; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: var(--primary-dark);"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">settings</span>ç®¡ç†è€…ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
            <button onclick="closeAdminPanel()" style="background: none; border: none; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; color: var(--gray-500);">Ã—</button>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--gray-500);">é¡§å®¢ã‚¿ã‚¤ãƒ—é¸æŠ</label>
            <select id="customerType" onchange="changeCustomerType()" style="width: 100%; padding: 8px; border: 1px solid var(--gray-200); border-radius: 5px;">
                <option value="new">æ–°è¦é¡§å®¢ï¼ˆç”°ä¸­æ§˜ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¸1</option>
                <option value="interested" selected>é–¢å¿ƒé¡§å®¢ï¼ˆéˆ´æœ¨æ§˜ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¸2</option>
                <option value="serious">æœ¬æ ¼æ¤œè¨ï¼ˆå±±ç”°æ§˜ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¸3</option>
                <option value="negotiating">å•†è«‡ä¸­ï¼ˆä½è—¤æ§˜ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¸4</option>
                <option value="closing">æˆç´„å‰ï¼ˆé«˜æ©‹æ§˜ï¼‰- ã‚¹ãƒ†ãƒ¼ã‚¸5</option>
            </select>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--gray-500);">ã‚¹ãƒ†ãƒ¼ã‚¸ç›´æ¥æŒ‡å®š</label>
            <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                <button class="stage-btn" onclick="setStage(1)" style="padding: 8px 16px; border: 1px solid var(--gray-200); background: white; cursor: pointer; border-radius: 5px;">S1</button>
                <button class="stage-btn active" onclick="setStage(2)" style="padding: 8px 16px; border: 1px solid var(--primary-light); background: var(--primary-lighter); cursor: pointer; border-radius: 5px; color: var(--primary-dark);">S2</button>
                <button class="stage-btn" onclick="setStage(3)" style="padding: 8px 16px; border: 1px solid var(--gray-200); background: white; cursor: pointer; border-radius: 5px;">S3</button>
                <button class="stage-btn" onclick="setStage(4)" style="padding: 8px 16px; border: 1px solid var(--gray-200); background: white; cursor: pointer; border-radius: 5px;">S4</button>
                <button class="stage-btn" onclick="setStage(5)" style="padding: 8px 16px; border: 1px solid var(--gray-200); background: white; cursor: pointer; border-radius: 5px;">S5</button>
            </div>
        </div>
        
        <div style="margin-bottom: 20px; padding: 15px; background: var(--gray-50); border-radius: 5px;">
            <p style="margin-bottom: 5px;"><strong>ç¾åœ¨ã®çŠ¶æ…‹ï¼š</strong></p>
            <p style="margin: 2px 0;">é¡§å®¢: <span id="currentCustomer">é–¢å¿ƒé¡§å®¢ï¼ˆéˆ´æœ¨æ§˜ï¼‰</span></p>
            <p style="margin: 2px 0;">ã‚¹ãƒ†ãƒ¼ã‚¸: <span id="currentStageInfo">ã‚¹ãƒ†ãƒ¼ã‚¸2</span></p>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <button onclick="unlockAll()" style="padding: 10px; background: var(--success); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ğŸ”“ å…¨è³‡æ–™ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</button>
            <button onclick="resetAll()" style="padding: 10px; background: var(--danger); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ğŸ”„ ã‚¹ãƒ†ãƒ¼ã‚¸2ã«ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <div class="container">
        <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
        <div class="breadcrumb">
            <a href="/member/">ç‰©ä»¶ä¸€è¦§</a> > <a href="/properties/001/">å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«</a>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
        <div class="stage-indicator">
            <h2 style="color: var(--primary-dark); margin-bottom: 20px;">ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸</h2>
            <div class="stage-progress">
                <div class="stage-item completed" id="stage1">
                    <div class="stage-circle">1</div>
                    <div class="stage-label">åˆå›æ¥è§¦</div>
                </div>
                <div class="stage-item current" id="stage2">
                    <div class="stage-circle">2</div>
                    <div class="stage-label">é–¢å¿ƒè¡¨æ˜</div>
                </div>
                <div class="stage-item" id="stage3">
                    <div class="stage-circle">3</div>
                    <div class="stage-label">è©³ç´°æ¤œè¨</div>
                </div>
                <div class="stage-item" id="stage4">
                    <div class="stage-circle">4</div>
                    <div class="stage-label">å•†è«‡</div>
                </div>
                <div class="stage-item" id="stage5">
                    <div class="stage-circle">5</div>
                    <div class="stage-label">æœ€çµ‚ç¢ºèª</div>
                </div>
            </div>
            <div class="stage-description">
                <h3>ã‚¹ãƒ†ãƒ¼ã‚¸5ï¼šæœ€çµ‚ç¢ºèª</h3>
                <p>å…¨ã¦ã®è³‡æ–™ã‚’ã”ç¢ºèªã„ãŸã ãã€æŠ•è³‡åˆ¤æ–­ã«å¿…è¦ãªæƒ…å ±ã‚’å…¨ã¦é–²è¦§ã§ãã‚‹æ®µéšã§ã™ã€‚</p>
                <p style="margin-top: 10px;"><strong>ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ¸ˆã¿ï¼š</strong>å…¨ã¦ã®è³‡æ–™</p>
                <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š</strong>LINEã§ã®ã”ç›¸è«‡ãƒ»ã”å¥‘ç´„ã®ãŠæ‰‹ç¶šã</p>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview', 1)">1. ç‰©ä»¶æ¦‚è¦</button>
            <button class="nav-tab" onclick="showTab('simulation', 2)">2. åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
            <button class="nav-tab" onclick="showTab('valuation', 3)">3. ä¾¡æ ¼æŸ»å®š</button>
            <button class="nav-tab" onclick="showTab('finance', 4)">4. èè³‡è¨ˆç”»</button>
            <button class="nav-tab" onclick="showTab('summary', 5)">5. æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼</button>
            <button class="nav-tab" onclick="showTab('documents', 5)">6. å¿…è¦æ›¸é¡ä¸€å¼</button>
        </div>

        <!-- 1. ç‰©ä»¶æ¦‚è¦ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸1ã§é–‹ç¤ºï¼‰ -->
        <div id="overview" class="tab-content active">
            <div class="section-card">
                <h2 class="section-title">1. ç‰©ä»¶æ¦‚è¦ãƒ»ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æ</h2>
                
                <!-- ç‰©ä»¶ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
                <div style="margin-bottom: 30px;">
                    <img src="/assets/images/properties/001/main.jpg" alt="å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ« ãƒ¡ã‚¤ãƒ³" style="width: 100%; height: auto; border-radius: 10px; margin-bottom: 15px; box-shadow: var(--shadow-sm);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <img src="/assets/images/properties/001/exterior.jpg" alt="å¤–è¦³" style="width: 100%; height: auto; border-radius: 10px; box-shadow: var(--shadow-sm);">
                        <img src="/assets/images/properties/001/interior.jpg" alt="ã‚ªãƒ•ã‚£ã‚¹å†…è¦³" style="width: 100%; height: auto; border-radius: 10px; box-shadow: var(--shadow-sm);">
                    </div>
                </div>
                
                <h3 class="subsection-title">åŸºæœ¬æƒ…å ±</h3>
                <div class="property-overview">
                    <div class="info-box">
                        <h4>ç‰©ä»¶åç§°</h4>
                        <p>å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«</p>
                        <p>æ±äº¬éƒ½æ¸¯åŒºå—é’å±±3ä¸ç›®15ç•ª8å·</p>
                    </div>
                    <div class="info-box">
                        <h4>ç‰©ä»¶ã‚¿ã‚¤ãƒ—</h4>
                        <p>RCé€  äº‹å‹™æ‰€ãƒ“ãƒ«</p>
                        <p>ç¯‰å¹´æœˆï¼š2018å¹´4æœˆç«£å·¥ï¼ˆç¯‰7å¹´ï¼‰</p>
                    </div>
                    <div class="info-box">
                        <h4>ç‰©ä»¶ä¾¡æ ¼</h4>
                        <span class="highlight-number">3å„„8,500ä¸‡å††</span>
                        <p>è¡¨é¢åˆ©å›ã‚Šï¼š9.0%ï¼ˆç¾æ³ï¼‰</p>
                    </div>
                </div>

                <h3 class="subsection-title">ç«‹åœ°è©•ä¾¡ãƒ»å»ºç‰©è©³ç´°</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th>å†…å®¹</th>
                            <th>è©•ä¾¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>æœ€å¯„é§…</td>
                            <td>æ±äº¬ãƒ¡ãƒˆãƒ­ã€Œè¡¨å‚é“ã€é§… å¾’æ­©4åˆ† / ã€Œå¤–è‹‘å‰ã€é§… å¾’æ­©8åˆ†</td>
                            <td>â˜…â˜…â˜…â˜…â˜…</td>
                        </tr>
                        <tr>
                            <td>éƒ½å¿ƒã‚¢ã‚¯ã‚»ã‚¹</td>
                            <td>éŠ€åº§ç·šãƒ»åŠè”µé–€ç·šãƒ»åƒä»£ç”°ç·šåˆ©ç”¨å¯ã€ä¸»è¦é§…ç›´é€š</td>
                            <td>â˜…â˜…â˜…â˜…â˜…</td>
                        </tr>
                        <tr>
                            <td>å‘¨è¾ºç’°å¢ƒ</td>
                            <td>å—é’å±±ã‚¨ãƒªã‚¢ã€é«˜ç´šã‚ªãƒ•ã‚£ã‚¹ãƒ»å•†æ¥­æ–½è¨­é›†ç©åœ°åŸŸ</td>
                            <td>â˜…â˜…â˜…â˜…â˜…</td>
                        </tr>
                        <tr>
                            <td>ç”¨é€”åœ°åŸŸ</td>
                            <td>ç¬¬äºŒç¨®ä¸­é«˜å±¤ä½å±…å°‚ç”¨åœ°åŸŸï¼ˆå»ºè’½ç‡60%/å®¹ç©ç‡300%ï¼‰</td>
                            <td>â˜…â˜…â˜…â˜…â˜†</td>
                        </tr>
                        <tr>
                            <td>æ•·åœ°é¢ç©</td>
                            <td>154.96ã¡ï¼ˆ46.88åªï¼‰ãƒ»å—è¥¿è§’åœ°</td>
                            <td>â˜…â˜…â˜…â˜…â˜…</td>
                        </tr>
                        <tr>
                            <td>å»ºç‰©è¦æ¨¡</td>
                            <td>RCé€ 3éšå»ºã¦ãƒ»å»¶åºŠ298.56ã¡ï¼ˆ90.31åªï¼‰</td>
                            <td>â˜…â˜…â˜…â˜…â˜†</td>
                        </tr>
                    </tbody>
                </table>

                <h3 class="subsection-title">æŠ•è³‡é©æ ¼æ€§è©•ä¾¡</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">DSCRï¼ˆèè³‡è¿”æ¸ˆå€ç‡ï¼‰</div>
                        <div class="kpi-value">3.21</div>
                        <div class="kpi-unit">å€ï¼ˆå„ªè‰¯åˆ¤å®šï¼‰</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">NOIåˆ©å›ã‚Š</div>
                        <div class="kpi-value">6.9</div>
                        <div class="kpi-unit">%</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">å…¥å±…ç‡</div>
                        <div class="kpi-value">83.3</div>
                        <div class="kpi-unit">%ï¼ˆ5/6å®¤ï¼‰</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-black" onclick="advanceStage()">è©³ç´°æƒ…å ±ã‚’å¸Œæœ›ã™ã‚‹</button>
                    <button class="btn btn-outline-black" onclick="requestConsultation()">è³ªå•ã™ã‚‹</button>
                </div>
            </div>
        </div>

        <!-- 2. åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸2ã§é–‹ç¤ºï¼‰ -->
        <div id="simulation" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">2. æŠ•è³‡åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                
                <h3 class="subsection-title">æŠ•è³‡æ¦‚è¦</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">ç‰©ä»¶ä¾¡æ ¼</div>
                        <div class="kpi-value">3.85</div>
                        <div class="kpi-unit">å„„å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">å¹´é–“è³ƒæ–™åå…¥ï¼ˆç¾æ³ï¼‰</div>
                        <div class="kpi-value">3,474</div>
                        <div class="kpi-unit">ä¸‡å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">æº€å®¤æƒ³å®šåå…¥</div>
                        <div class="kpi-value">4,170</div>
                        <div class="kpi-unit">ä¸‡å††/å¹´</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">è¡¨é¢åˆ©å›ã‚Šï¼ˆç¾æ³ï¼‰</div>
                        <div class="kpi-value">9.0</div>
                        <div class="kpi-unit">%</div>
                    </div>
                </div>

                <h3 class="subsection-title">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼äºˆæ¸¬ï¼ˆå¹´é–“ï¼‰</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th>1å¹´ç›®</th>
                            <th>5å¹´ç›®</th>
                            <th>10å¹´ç›®</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>è³ƒæ–™åå…¥ï¼ˆæº€å®¤æƒ³å®šï¼‰</td>
                            <td style="text-align: right;">4,170ä¸‡å††</td>
                            <td style="text-align: right;">4,212ä¸‡å††</td>
                            <td style="text-align: right;">4,297ä¸‡å††</td>
                        </tr>
                        <tr>
                            <td>ç®¡ç†è²»ãƒ»ä¿®ç¹•ç©ç«‹é‡‘</td>
                            <td style="text-align: right;">-813ä¸‡å††</td>
                            <td style="text-align: right;">-821ä¸‡å††</td>
                            <td style="text-align: right;">-846ä¸‡å††</td>
                        </tr>
                        <tr>
                            <td>ãƒ­ãƒ¼ãƒ³è¿”æ¸ˆï¼ˆLTV60%ï¼‰</td>
                            <td style="text-align: right;">-1,036ä¸‡å††</td>
                            <td style="text-align: right;">-1,036ä¸‡å††</td>
                            <td style="text-align: right;">-1,036ä¸‡å††</td>
                        </tr>
                        <tr style="background: var(--primary-lighter);">
                            <td><strong>ç´”åç›Šï¼ˆç¨å‰ï¼‰</strong></td>
                            <td style="text-align: right; font-weight: bold; color: var(--primary-dark);">2,321ä¸‡å††</td>
                            <td style="text-align: right; font-weight: bold; color: var(--primary-dark);">2,355ä¸‡å††</td>
                            <td style="text-align: right; font-weight: bold; color: var(--primary-dark);">2,415ä¸‡å††</td>
                        </tr>
                    </tbody>
                </table>

                <div class="action-buttons">
                    <button class="btn btn-black" onclick="advanceStage()">ä¾¡æ ¼æŸ»å®šã‚’ç¢ºèªã™ã‚‹</button>
                    <button class="btn btn-outline-black" onclick="requestConsultation()">å°‚é–€å®¶ã«ç›¸è«‡ã™ã‚‹</button>
                </div>
            </div>
        </div>

        <!-- 3. ä¾¡æ ¼æŸ»å®šï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸3ã§é–‹ç¤ºï¼‰ -->
        <div id="valuation" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">3. PRISMç‹¬è‡ªä¾¡æ ¼æŸ»å®šåˆ†æ</h2>
                
                <h3 class="subsection-title">ç¾æ³ãƒ¬ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>éš</th>
                            <th>ãƒ†ãƒŠãƒ³ãƒˆ</th>
                            <th>æ¥­ç¨®</th>
                            <th>è³ƒæ–™/æœˆ</th>
                            <th>å¥‘ç´„æœŸé–“</th>
                            <th>çŠ¶æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>3F</td>
                            <td>ãƒ‡ãƒ«ã‚¿æ ªå¼ä¼šç¤¾</td>
                            <td>IT</td>
                            <td style="text-align: right;">550,000å††</td>
                            <td>2024.01ã€œ2025.12</td>
                            <td style="color: var(--success);">å…¥å±…ä¸­</td>
                        </tr>
                        <tr>
                            <td>3F</td>
                            <td>ã‚¨ãƒ—ã‚·ãƒ­ãƒ³åˆåŒä¼šç¤¾</td>
                            <td>ã‚³ãƒ³ã‚µãƒ«</td>
                            <td style="text-align: right;">530,000å††</td>
                            <td>2025.02ã€œ2027.01</td>
                            <td style="color: var(--success);">å…¥å±…ä¸­</td>
                        </tr>
                        <tr>
                            <td>2F</td>
                            <td>æ ªå¼ä¼šç¤¾ã‚¬ãƒ³ãƒ</td>
                            <td>å•†ç¤¾</td>
                            <td style="text-align: right;">540,000å††</td>
                            <td>2022.10ã€œ2024.09</td>
                            <td style="color: var(--warning);">æ›´æ–°äº¤æ¸‰ä¸­</td>
                        </tr>
                        <tr style="background: #fff5f5;">
                            <td>2F</td>
                            <td style="color: var(--danger);">â€•</td>
                            <td>â€•</td>
                            <td style="text-align: right; color: var(--danger);">ï¼ˆå‹Ÿé›†ä¸­ï¼‰</td>
                            <td>â€•</td>
                            <td style="color: var(--danger);">ç©ºå®¤</td>
                        </tr>
                        <tr>
                            <td>1F</td>
                            <td>æ ªå¼ä¼šç¤¾ã‚¢ãƒ«ãƒ•ã‚¡</td>
                            <td>åºƒå‘Š</td>
                            <td style="text-align: right;">580,000å††</td>
                            <td>2023.04ã€œ2025.03</td>
                            <td style="color: var(--warning);">æ›´æ–°äºˆå®š</td>
                        </tr>
                        <tr>
                            <td>1F</td>
                            <td>åˆåŒä¼šç¤¾ãƒ™ãƒ¼ã‚¿</td>
                            <td>ä¸å‹•ç”£</td>
                            <td style="text-align: right;">560,000å††</td>
                            <td>2024.07ã€œ2026.06</td>
                            <td style="color: var(--success);">å…¥å±…ä¸­</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 class="subsection-title">æŸ»å®šçµæœã‚µãƒãƒªãƒ¼</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">å£²å‡ºä¾¡æ ¼</div>
                        <div class="kpi-value">3.85</div>
                        <div class="kpi-unit">å„„å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">PRISMæŸ»å®šä¾¡æ ¼</div>
                        <div class="kpi-value">3.81</div>
                        <div class="kpi-unit">å„„å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">ä¾¡æ ¼å¦¥å½“æ€§</div>
                        <div class="kpi-value" style="color: var(--success);">é©æ­£</div>
                        <div class="kpi-unit">å¸‚å ´ä¾¡æ ¼</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">æŠ•è³‡æ¨å¥¨åº¦</div>
                        <div class="kpi-value">S</div>
                        <div class="kpi-unit">æœ€å„ªå…ˆæ¨å¥¨</div>
                    </div>
                </div>
                
                <h3 class="subsection-title">å»ºç‰©è¨­å‚™ä»•æ§˜</h3>
                <div class="property-overview">
                    <div class="info-box">
                        <h4>é›»æ°—è¨­å‚™</h4>
                        <p>60VA/ã¡ãƒ»é«˜åœ§å—é›»</p>
                        <p>å„éšå€‹åˆ¥å¥‘ç´„å¯¾å¿œ</p>
                    </div>
                    <div class="info-box">
                        <h4>ç©ºèª¿è¨­å‚™</h4>
                        <p>å€‹åˆ¥ç©ºèª¿æ–¹å¼</p>
                        <p>24æ™‚é–“å¯¾å¿œå¯èƒ½</p>
                    </div>
                    <div class="info-box">
                        <h4>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h4>
                        <p>ã‚»ã‚³ãƒ 24æ™‚é–“ç›£è¦–</p>
                        <p>ICã‚«ãƒ¼ãƒ‰å¯¾å¿œ</p>
                    </div>
                </div>
                
                <h3 class="subsection-title">å…¬çš„è©•ä¾¡ãƒ»æ‹…ä¿è©•ä¾¡åˆ†æ</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>è©•ä¾¡æ–¹æ³•</th>
                            <th>è©•ä¾¡é¡ï¼ˆå††ï¼‰</th>
                            <th>æœ€çµ‚è©•ä¾¡é¡ã¨ã®å·®</th>
                            <th>å‚™è€ƒ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>æœ€çµ‚è©•ä¾¡é¡ï¼ˆæœ¬ãƒ¬ãƒãƒ¼ãƒˆï¼‰</td>
                            <td style="text-align: right; font-weight: 600;">385,000,000</td>
                            <td style="text-align: center;">åŸºæº–</td>
                            <td>å¸‚å ´æ€§è€ƒæ…®</td>
                        </tr>
                        <tr>
                            <td>ç©ç®—ä¾¡æ ¼</td>
                            <td style="text-align: right;">381,205,529</td>
                            <td style="text-align: center;">-1.0%</td>
                            <td>åœŸåœ°ãƒ»å»ºç‰©åˆè¨ˆ</td>
                        </tr>
                        <tr>
                            <td>åç›Šé‚„å…ƒä¾¡æ ¼ï¼ˆå¹³å‡ï¼‰</td>
                            <td style="text-align: right;">363,675,500</td>
                            <td style="text-align: center;">-5.5%</td>
                            <td>DCFãƒ»ç›´æ¥é‚„å…ƒæ³•</td>
                        </tr>
                        <tr style="background: var(--primary-lighter);">
                            <td><strong>éŠ€è¡Œæ‹…ä¿è©•ä¾¡ï¼ˆæ¨å®šï¼‰</strong></td>
                            <td style="text-align: right;"><strong>276,211,593</strong></td>
                            <td style="text-align: center;"><strong>-28.3%</strong></td>
                            <td><strong>ä¿å®ˆçš„è©•ä¾¡</strong></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 20px; background: var(--primary-lighter);">
                    <h4 style="color: var(--primary-dark); margin-bottom: 15px;">èè³‡æ¡ä»¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
                    <table class="specs-table">
                        <thead>
                            <tr>
                                <th>LTV</th>
                                <th>èè³‡å¯èƒ½é¡</th>
                                <th>å¿…è¦è‡ªå·±è³‡é‡‘</th>
                                <th>DSCRï¼ˆæƒ³å®šï¼‰</th>
                                <th>èè³‡åˆ¤å®š</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>50%</td>
                                <td style="text-align: right;">138,105,797å††</td>
                                <td style="text-align: right;">246,894,203å††</td>
                                <td style="text-align: center;">3.85</td>
                                <td style="text-align: center; color: var(--success);">â—å„ªè‰¯</td>
                            </tr>
                            <tr style="background: var(--primary-lighter);">
                                <td><strong>60%</strong></td>
                                <td style="text-align: right;"><strong>231,000,000å††</strong></td>
                                <td style="text-align: right;"><strong>154,000,000å††</strong></td>
                                <td style="text-align: center;"><strong>3.21</strong></td>
                                <td style="text-align: center; color: var(--success);"><strong>â—å„ªè‰¯</strong></td>
                            </tr>
                            <tr>
                                <td>70%</td>
                                <td style="text-align: right;">269,500,000å††</td>
                                <td style="text-align: right;">115,500,000å††</td>
                                <td style="text-align: center;">2.75</td>
                                <td style="text-align: center; color: var(--success);">â—‹è‰¯å¥½</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px; color: var(--primary-text); font-size: 0.9em;">
                        <p><strong>æ¨å¥¨èè³‡æ¡ä»¶ï¼š</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px; line-height: 1.8;">
                            <li>LTV 60%ä»¥å†…ï¼ˆèè³‡é¡2.31å„„å††ï¼‰</li>
                            <li>é‡‘åˆ© 1.0ï½1.5%ï¼ˆå¤‰å‹•é‡‘åˆ©ï¼‰</li>
                            <li>è¿”æ¸ˆæœŸé–“ 20ï½25å¹´</li>
                            <li>DSCR 3.21å€ï¼ˆååˆ†ãªè¿”æ¸ˆä½™åŠ›ï¼‰</li>
                        </ul>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-black" onclick="advanceStage()">èè³‡è¨ˆç”»ã‚’ç¢ºèªã™ã‚‹</button>
                </div>
            </div>
        </div>

        <!-- 4. èè³‡è¨ˆç”»ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸4ã§é–‹ç¤ºï¼‰ -->
        <div id="finance" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">4. èè³‡è¨ˆç”»ãƒ»éŠ€è¡Œè©•ä¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                
                <h3 class="subsection-title">æ¨å¥¨èè³‡ãƒ—ãƒ©ãƒ³</h3>
                <div class="property-overview">
                    <div class="info-box">
                        <h4>èè³‡é‡‘é¡</h4>
                        <span class="highlight-number">2.31å„„å††</span>
                        <p>èè³‡æ¯”ç‡ï¼š60%ï¼ˆLTVï¼‰</p>
                    </div>
                    <div class="info-box">
                        <h4>è‡ªå·±è³‡é‡‘</h4>
                        <span class="highlight-number">1.54å„„å††</span>
                        <p>é ­é‡‘ï¼‹è«¸è²»ç”¨</p>
                    </div>
                    <div class="info-box">
                        <h4>æƒ³å®šé‡‘åˆ©</h4>
                        <span class="highlight-number">1.5%</span>
                        <p>å¤‰å‹•é‡‘åˆ©ï¼ˆå„ªé‡é‡‘åˆ©ï¼‰</p>
                    </div>
                </div>
                
                <h3 class="subsection-title">è¿”æ¸ˆè¨ˆç”»è©³ç´°</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">æœˆé¡è¿”æ¸ˆé¡</div>
                        <div class="kpi-value">103.6</div>
                        <div class="kpi-unit">ä¸‡å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">å¹´é–“è¿”æ¸ˆé¡</div>
                        <div class="kpi-value">1,243</div>
                        <div class="kpi-unit">ä¸‡å††</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">è¿”æ¸ˆæœŸé–“</div>
                        <div class="kpi-value">22</div>
                        <div class="kpi-unit">å¹´</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">ç·è¿”æ¸ˆé¡</div>
                        <div class="kpi-value">3.11</div>
                        <div class="kpi-unit">å„„å††</div>
                    </div>
                </div>
                
                <h3 class="subsection-title">25å¹´é–“è¿”æ¸ˆè¨ˆç”»</h3>
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid var(--gray-200); margin-bottom: 20px;">
                    <table class="specs-table">
                        <thead style="position: sticky; top: 0; background: white; z-index: 1;">
                            <tr>
                                <th>å¹´</th>
                                <th>æœˆé¡è¿”æ¸ˆ</th>
                                <th>å¹´é–“å…ƒé‡‘</th>
                                <th>å¹´é–“åˆ©æ¯</th>
                                <th>ç´¯è¨ˆå…ƒé‡‘</th>
                                <th>æ®‹å…ƒé‡‘</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,067,200å††</td>
                                <td style="text-align: right;">3,364,800å††</td>
                                <td style="text-align: right;">9,067,200å††</td>
                                <td style="text-align: right;">221,932,800å††</td>
                            </tr>
                            <tr>
                                <td>2å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,203,308å††</td>
                                <td style="text-align: right;">3,228,692å††</td>
                                <td style="text-align: right;">18,270,508å††</td>
                                <td style="text-align: right;">212,729,492å††</td>
                            </tr>
                            <tr>
                                <td>3å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,343,357å††</td>
                                <td style="text-align: right;">3,088,643å††</td>
                                <td style="text-align: right;">27,613,865å††</td>
                                <td style="text-align: right;">203,386,135å††</td>
                            </tr>
                            <tr>
                                <td>4å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,487,412å††</td>
                                <td style="text-align: right;">2,944,588å††</td>
                                <td style="text-align: right;">37,101,277å††</td>
                                <td style="text-align: right;">193,898,723å††</td>
                            </tr>
                            <tr style="background: var(--primary-lighter);">
                                <td><strong>5å¹´ç›®</strong></td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;"><strong>9,635,543å††</strong></td>
                                <td style="text-align: right;">2,796,457å††</td>
                                <td style="text-align: right;"><strong>46,736,820å††</strong></td>
                                <td style="text-align: right;"><strong>184,263,180å††</strong></td>
                            </tr>
                            <tr>
                                <td>6å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,787,817å††</td>
                                <td style="text-align: right;">2,644,183å††</td>
                                <td style="text-align: right;">56,524,637å††</td>
                                <td style="text-align: right;">174,475,363å††</td>
                            </tr>
                            <tr>
                                <td>7å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">9,944,304å††</td>
                                <td style="text-align: right;">2,487,696å††</td>
                                <td style="text-align: right;">66,468,941å††</td>
                                <td style="text-align: right;">164,531,059å††</td>
                            </tr>
                            <tr>
                                <td>8å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">10,105,069å††</td>
                                <td style="text-align: right;">2,326,931å††</td>
                                <td style="text-align: right;">76,574,010å††</td>
                                <td style="text-align: right;">154,425,990å††</td>
                            </tr>
                            <tr>
                                <td>9å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">10,270,195å††</td>
                                <td style="text-align: right;">2,161,805å††</td>
                                <td style="text-align: right;">86,844,205å††</td>
                                <td style="text-align: right;">144,155,795å††</td>
                            </tr>
                            <tr style="background: var(--primary-lighter);">
                                <td><strong>10å¹´ç›®</strong></td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;"><strong>10,439,748å††</strong></td>
                                <td style="text-align: right;">1,992,252å††</td>
                                <td style="text-align: right;"><strong>97,283,953å††</strong></td>
                                <td style="text-align: right;"><strong>133,716,047å††</strong></td>
                            </tr>
                            <tr>
                                <td>11å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">10,613,904å††</td>
                                <td style="text-align: right;">1,818,096å††</td>
                                <td style="text-align: right;">107,897,857å††</td>
                                <td style="text-align: right;">123,102,143å††</td>
                            </tr>
                            <tr>
                                <td>12å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">10,792,743å††</td>
                                <td style="text-align: right;">1,639,257å††</td>
                                <td style="text-align: right;">118,690,600å††</td>
                                <td style="text-align: right;">112,309,400å††</td>
                            </tr>
                            <tr>
                                <td>13å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">10,976,435å††</td>
                                <td style="text-align: right;">1,455,565å††</td>
                                <td style="text-align: right;">129,667,035å††</td>
                                <td style="text-align: right;">101,332,965å††</td>
                            </tr>
                            <tr>
                                <td>14å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">11,165,162å††</td>
                                <td style="text-align: right;">1,266,838å††</td>
                                <td style="text-align: right;">140,832,197å††</td>
                                <td style="text-align: right;">90,167,803å††</td>
                            </tr>
                            <tr style="background: var(--primary-lighter);">
                                <td><strong>15å¹´ç›®</strong></td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;"><strong>11,359,115å††</strong></td>
                                <td style="text-align: right;">1,072,885å††</td>
                                <td style="text-align: right;"><strong>152,191,312å††</strong></td>
                                <td style="text-align: right;"><strong>78,808,688å††</strong></td>
                            </tr>
                            <tr>
                                <td>16å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">11,558,483å††</td>
                                <td style="text-align: right;">873,517å††</td>
                                <td style="text-align: right;">163,749,795å††</td>
                                <td style="text-align: right;">67,250,205å††</td>
                            </tr>
                            <tr>
                                <td>17å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">11,763,462å††</td>
                                <td style="text-align: right;">668,538å††</td>
                                <td style="text-align: right;">175,513,257å††</td>
                                <td style="text-align: right;">55,486,743å††</td>
                            </tr>
                            <tr>
                                <td>18å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">11,974,248å††</td>
                                <td style="text-align: right;">457,752å††</td>
                                <td style="text-align: right;">187,487,505å††</td>
                                <td style="text-align: right;">43,512,495å††</td>
                            </tr>
                            <tr>
                                <td>19å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">12,191,032å††</td>
                                <td style="text-align: right;">240,968å††</td>
                                <td style="text-align: right;">199,678,537å††</td>
                                <td style="text-align: right;">31,321,463å††</td>
                            </tr>
                            <tr style="background: var(--primary-lighter);">
                                <td><strong>20å¹´ç›®</strong></td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;"><strong>12,414,013å††</strong></td>
                                <td style="text-align: right;">17,987å††</td>
                                <td style="text-align: right;"><strong>212,092,550å††</strong></td>
                                <td style="text-align: right;"><strong>18,907,450å††</strong></td>
                            </tr>
                            <tr>
                                <td>21å¹´ç›®</td>
                                <td style="text-align: right;">1,036,000å††</td>
                                <td style="text-align: right;">12,643,393å††</td>
                                <td style="text-align: right;">0å††</td>
                                <td style="text-align: right;">224,735,943å††</td>
                                <td style="text-align: right;">6,264,057å††</td>
                            </tr>
                            <tr>
                                <td>22å¹´ç›®</td>
                                <td style="text-align: right;">525,304å††</td>
                                <td style="text-align: right;">6,264,057å††</td>
                                <td style="text-align: right;">39,605å††</td>
                                <td style="text-align: right;">231,000,000å††</td>
                                <td style="text-align: right;">0å††</td>
                            </tr>
                            <tr style="background: var(--success-light);">
                                <td><strong>å®Œæ¸ˆ</strong></td>
                                <td style="text-align: center;"><strong>22å¹´ç›®ã§å®Œæ¸ˆ</strong></td>
                                <td style="text-align: right;"><strong>231,000,000å††</strong></td>
                                <td style="text-align: right;"><strong>80,840,040å††</strong></td>
                                <td style="text-align: right;"><strong>231,000,000å††</strong></td>
                                <td style="text-align: right;"><strong>0å††</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="background: var(--primary-lighter); padding: 20px; margin: 20px 0;">
                    <h4 style="color: var(--primary-dark); margin-bottom: 15px;">è¿”æ¸ˆè¨ˆç”»ã‚µãƒãƒªãƒ¼</h4>
                    <div class="property-overview">
                        <div class="info-box">
                            <h5>å®Œæ¸ˆå¹´æ•°</h5>
                            <span class="highlight-number">22å¹´</span>
                            <p>è¨­å®šæœŸé–“25å¹´ã‚ˆã‚Š3å¹´æ—©æœŸå®Œæ¸ˆ</p>
                        </div>
                        <div class="info-box">
                            <h5>ç·è¿”æ¸ˆé¡</h5>
                            <span class="highlight-number">3.118å„„å††</span>
                            <p>å…ƒé‡‘2.31å„„å††ï¼‹åˆ©æ¯8,084ä¸‡å††</p>
                        </div>
                        <div class="info-box">
                            <h5>åˆ©æ¯ç·é¡</h5>
                            <span class="highlight-number">8,084ä¸‡å††</span>
                            <p>å…ƒé‡‘ã«å¯¾ã™ã‚‹åˆ©æ¯æ¯”ç‡ï¼š35.0%</p>
                        </div>
                    </div>
                </div>
                
                <h3 class="subsection-title">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã‚«ãƒãƒ¼ãƒ¬ã‚·ã‚ªåˆ†æ</h3>
                <div class="property-overview">
                    <div class="info-box">
                        <h4>DSCRï¼ˆå‚µå‹™è¿”æ¸ˆã‚«ãƒãƒ¼ç‡ï¼‰</h4>
                        <span class="highlight-number">3.21å€</span>
                        <p>å„ªè‰¯ãªè¿”æ¸ˆä½™åŠ›</p>
                    </div>
                    <div class="info-box">
                        <h4>è¿”æ¸ˆæ¯”ç‡</h4>
                        <span class="highlight-number">35.8%</span>
                        <p>NOIã«å ã‚ã‚‹è¿”æ¸ˆã®å‰²åˆ</p>
                    </div>
                    <div class="info-box">
                        <h4>ãƒ•ãƒªãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼</h4>
                        <span class="highlight-number">1,366ä¸‡å††</span>
                        <p>ãƒ­ãƒ¼ãƒ³è¿”æ¸ˆå¾Œã®æ‰‹æ®‹ã‚Š</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 20px; background: var(--primary-bg);">
                    <h4 style="color: var(--primary-dark); margin-bottom: 15px;">èè³‡æ¡ä»¶ãƒ¡ãƒ¢</h4>
                    <p style="line-height: 1.8; color: var(--primary-text);">
                        <strong>æœ¬ç‰©ä»¶ã®èè³‡ç‰¹å¾´ï¼š</strong><br>
                        ãƒ» DSCR 3.21å€ã¨ååˆ†ãªè¿”æ¸ˆä½™åŠ›ãŒã‚ã‚Šã€éŠ€è¡Œèè³‡ã®å–ã‚Šä»˜ã‘ãŒå®¹æ˜“<br>
                        ãƒ» æœˆé¡103.6ä¸‡å††ã®è¿”æ¸ˆã«å¯¾ã—ã¦ã€NOIãŒ2,661ä¸‡å††ã¨ååˆ†ãªãƒãƒ¼ã‚¸ãƒ³<br>
                        ãƒ» å—é’å±±ã®å„ªè‰¯ç‰©ä»¶ã§ã‚ã‚Šã€æ‹…ä¿ä¾¡å€¤ãŒå®‰å®šã—ã¦ã„ã‚‹ãŸã‚å„ªé‡é‡‘åˆ©ã®é©ç”¨ãŒæœŸå¾…<br>
                        ãƒ» 25å¹´é–“ã®é•·æœŸè¿”æ¸ˆã§æœˆé¡è² æ‹…ã‚’æŠ‘åˆ¶ã—ã€å®‰å®šçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºä¿
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-black" onclick="advanceStage()">æœ€çµ‚ç¢ºèªã¸é€²ã‚€</button>
                    <button class="btn btn-outline-black" onclick="requestConsultation()">èè³‡ç›¸è«‡ã‚’ç”³ã—è¾¼ã‚€</button>
                </div>
            </div>
        </div>

        <!-- 5. æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸5ã§é–‹ç¤ºï¼‰ -->
        <div id="summary" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">5. æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼</h2>
                
                <div style="background: var(--primary-lighter); padding: 30px; text-align: center; margin: 20px 0;">
                    <h2 style="color: var(--primary-dark); margin-bottom: 20px;">PRISMæŠ•è³‡æ¨å¥¨åº¦</h2>
                    <span style="font-size: 4em; color: var(--primary-dark); font-weight: bold;">S</span>
                    <p style="margin-top: 10px; font-size: 1.2em;">æœ€å„ªå…ˆæ¨å¥¨</p>
                </div>
                
                <h3 class="subsection-title">DCFæ³•ã«ã‚ˆã‚‹åç›Šä¾¡æ ¼ç®—å®š</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th>è¨­å®šå€¤</th>
                            <th>è¨­å®šæ ¹æ‹ </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>åˆ†ææœŸé–“</td>
                            <td>10å¹´é–“</td>
                            <td>ä¸€èˆ¬çš„ãªä¸å‹•ç”£æŠ•è³‡æœŸé–“</td>
                        </tr>
                        <tr>
                            <td>å‰²å¼•ç‡</td>
                            <td>3.5%</td>
                            <td>å—é’å±±ã‚¨ãƒªã‚¢ã®å„ªè‰¯ç‰©ä»¶ãƒªã‚¹ã‚¯</td>
                        </tr>
                        <tr>
                            <td>æœ€çµ‚é‚„å…ƒåˆ©å›ã‚Š</td>
                            <td>4.0%</td>
                            <td>å‰²å¼•ç‡ï¼‹0.5%ï¼ˆç«‹åœ°ã®å®‰å®šæ€§è€ƒæ…®ï¼‰</td>
                        </tr>
                        <tr>
                            <td>è³ƒæ–™ä¸Šæ˜‡ç‡ï¼ˆ1-5å¹´ç›®ï¼‰</td>
                            <td>1.0%/å¹´</td>
                            <td>å—é’å±±ã‚¨ãƒªã‚¢ã®éœ€è¦å¢—åŠ å‚¾å‘</td>
                        </tr>
                        <tr>
                            <td>ç©ºå®¤ç‡</td>
                            <td>5.0%</td>
                            <td>ã‚¨ãƒªã‚¢å¹³å‡æ°´æº–ï¼ˆå„ªè‰¯ç‰©ä»¶ï¼‰</td>
                        </tr>
                        <tr style="background: var(--primary-lighter);">
                            <td><strong>DCFæ³•ã«ã‚ˆã‚‹åç›Šä¾¡æ ¼</strong></td>
                            <td colspan="2" style="text-align: center; font-size: 1.2em; font-weight: bold;">357,782,000å††</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 class="subsection-title">10å¹´é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼äºˆæ¸¬</h3>
                <table class="specs-table">
                    <thead>
                        <tr>
                            <th>å¹´æ¬¡</th>
                            <th>ç·åå…¥</th>
                            <th>é‹å–¶è²»ç”¨</th>
                            <th>NOI</th>
                            <th>è³‡æœ¬çš„æ”¯å‡º</th>
                            <th>NCF</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1å¹´ç›®</td>
                            <td style="text-align: right;">34,740,000</td>
                            <td style="text-align: right;">8,130,610</td>
                            <td style="text-align: right;">26,609,390</td>
                            <td style="text-align: right;">1,000,000</td>
                            <td style="text-align: right;">25,609,390</td>
                        </tr>
                        <tr>
                            <td>2å¹´ç›®</td>
                            <td style="text-align: right;">35,087,400</td>
                            <td style="text-align: right;">8,211,916</td>
                            <td style="text-align: right;">26,875,484</td>
                            <td style="text-align: right;">1,000,000</td>
                            <td style="text-align: right;">25,875,484</td>
                        </tr>
                        <tr>
                            <td>3å¹´ç›®</td>
                            <td style="text-align: right;">35,438,274</td>
                            <td style="text-align: right;">8,294,035</td>
                            <td style="text-align: right;">27,144,239</td>
                            <td style="text-align: right;">1,000,000</td>
                            <td style="text-align: right;">26,144,239</td>
                        </tr>
                        <tr>
                            <td>5å¹´ç›®</td>
                            <td style="text-align: right;">36,150,583</td>
                            <td style="text-align: right;">8,460,745</td>
                            <td style="text-align: right;">27,689,838</td>
                            <td style="text-align: right;">5,000,000</td>
                            <td style="text-align: right;">22,689,838</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 class="subsection-title">æŠ•è³‡æŒ‡æ¨™ã‚µãƒãƒªãƒ¼</h3>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">10å¹´é–“å¹³å‡NOI</div>
                        <div class="kpi-value">2,853</div>
                        <div class="kpi-unit">ä¸‡å††/å¹´</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">NOIåˆ©å›ã‚Šï¼ˆç¾æ³ï¼‰</div>
                        <div class="kpi-value">6.9</div>
                        <div class="kpi-unit">%</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">NCFåˆ©å›ã‚Šï¼ˆç¾æ³ï¼‰</div>
                        <div class="kpi-value">6.65</div>
                        <div class="kpi-unit">%</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">ç·åˆæŠ•è³‡åˆ©å›ã‚Šï¼ˆIRRï¼‰</div>
                        <div class="kpi-value">12.8</div>
                        <div class="kpi-unit">%</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: var(--primary-bg);">
                    <h4 style="color: var(--primary-dark); margin-bottom: 15px;">æŠ•è³‡åˆ¤æ–­ç·æ‹¬</h4>
                    <p style="line-height: 1.8; color: var(--primary-text);">
                        <strong>æœ¬ç‰©ä»¶ã¯ä»¥ä¸‹ã®ç†ç”±ã«ã‚ˆã‚Šæœ€å„ªå…ˆæ¨å¥¨ç‰©ä»¶ã¨åˆ¤å®šã—ã¾ã—ãŸï¼š</strong><br>
                        1. è¡¨å‚é“é§…å¾’æ­©4åˆ†ã¨ã„ã†å„ªè‰¯ãªç«‹åœ°æ¡ä»¶<br>
                        2. DSCR 3.21å€ã¨ã„ã†ååˆ†ãªè¿”æ¸ˆä½™åŠ›<br>
                        3. NOIåˆ©å›ã‚Š6.9%ã¨é«˜æ°´æº–ã®åç›Šæ€§<br>
                        4. ç©ç®—ä¾¡æ ¼ã¨å¸‚å ´ä¾¡æ ¼ãŒè¿‘ä¼¼ã—ã¦ãŠã‚Šã€è³‡ç”£ä¾¡å€¤ã®è£·ä»˜ã‘ãŒæ˜ç¢º<br>
                        5. å—é’å±±ã‚¨ãƒªã‚¢ã®å°†æ¥æ€§ã¨å¸Œå°‘æ€§ã‹ã‚‰ã€é•·æœŸçš„ãªè³‡ç”£ä¾¡å€¤ç¶­æŒãŒæœŸå¾…ã•ã‚Œã‚‹
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-black" onclick="requestConsultation()">LINEã§å¥‘ç´„ç›¸è«‡</button>
                </div>
            </div>
        </div>

        <!-- 6. å¿…è¦æ›¸é¡ä¸€å¼ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸5ã§é–‹ç¤ºï¼‰ -->
        <div id="documents" class="tab-content">
            <div class="section-card">
                <h2 class="section-title">6. ã”æä¾›è³‡æ–™ä¸€è¦§</h2>
                
                <h3 class="subsection-title">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½è³‡æ–™</h3>
                <div style="background: var(--gray-50); padding: 30px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                ç‰©ä»¶æ¦‚è¦æ›¸ï¼ˆè©³ç´°ç‰ˆï¼‰
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                ç‰©ä»¶ã®åŸºæœ¬æƒ…å ±ã€ç«‹åœ°æ¡ä»¶ã€å»ºç‰©ä»•æ§˜ã€ãƒ¬ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¨˜è¼‰ã—ãŸè©³ç´°ãªæ¦‚è¦æ›¸ã§ã™ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadDocument('property-overview')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">description</span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                PRISMä¾¡å€¤è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                æœ¬ãƒ¬ãƒãƒ¼ãƒˆã®å®Œå…¨ç‰ˆï¼ˆ30ãƒšãƒ¼ã‚¸ï¼‰ã€‚å…¬çš„è©•ä¾¡ã€æ‹…ä¿è©•ä¾¡ã€DCFåˆ†æã€25å¹´èè³‡è¨ˆç”»ãªã©ã‚’å«ã‚€ç·åˆçš„ãªæŠ•è³‡åˆ¤æ–­è³‡æ–™ã§ã™ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadPDF('complete')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">picture_as_pdf</span>PDFç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                10å¹´é–“åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                Excelãƒ•ã‚¡ã‚¤ãƒ«ã§ç·¨é›†å¯èƒ½ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼äºˆæ¸¬ã€‚è³ƒæ–™ä¸Šæ˜‡ã€ç©ºå®¤ç‡ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ã‚·ãƒŠãƒªã‚ªåˆ†æãŒå¯èƒ½ã§ã™ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadDocument('cashflow-simulation')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">table_chart</span>Excelãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                èè³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                æ¨å¥¨é‡‘èæ©Ÿé–¢ã§ã®èè³‡æ¡ä»¶ã€25å¹´è¿”æ¸ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€å¿…è¦æ›¸é¡ã®ä¸€è¦§ã‚’è¨˜è¼‰ã—ãŸèè³‡ææ¡ˆæ›¸ã§ã™ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadDocument('loan-simulation')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">account_balance</span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                é‡è¦äº‹é …èª¬æ˜æ›¸ï¼ˆæ¡ˆï¼‰
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                ä¸å‹•ç”£å–å¼•ã«ãŠã‘ã‚‹é‡è¦äº‹é …ã‚’ã¾ã¨ã‚ãŸæ³•çš„æ›¸é¡ã§ã™ã€‚å–å¼•å‰ã«å¿…ãšã”ç¢ºèªãã ã•ã„ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadDocument('important-matters')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">gavel</span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; height: 100%;">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="color: var(--success); margin-right: 10px; font-size: 1.2em;">âœ“</span>
                                å£²è²·å¥‘ç´„æ›¸ï¼ˆæ¡ˆï¼‰
                            </h4>
                            <p style="font-size: 0.9em; color: var(--gray-500); line-height: 1.6; margin-bottom: 15px; flex-grow: 1;">
                                æœ¬ç‰©ä»¶ã®å£²è²·å¥‘ç´„æ›¸ã®ãƒ‰ãƒ©ãƒ•ãƒˆç‰ˆã§ã™ã€‚å®Ÿéš›ã®å¥‘ç´„æ™‚ã«ã¯æœ€æ–°æƒ…å ±ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚
                            </p>
                            <button class="btn btn-black" onclick="downloadDocument('sales-contract')" style="width: 100%; font-size: 0.9em; opacity: 1; visibility: visible; display: flex; align-items: center; justify-content: center;"><span class="material-icons" style="margin-right: 8px; font-size: 18px;">description</span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-black" onclick="downloadAllDocuments()" style="display: inline-flex; align-items: center; justify-content: center; padding: 15px 30px; font-size: 1.1em;"><span class="material-icons" style="margin-right: 8px; font-size: 24px;">download</span>å…¨è³‡æ–™ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨è³‡æ–™é–‹æ”¾ï¼‰
        let currentStage = 5;
        let isAdminMode = false;
        
        function showTab(tabId, requiredStage) {
            // å¿…è¦ãªã‚¹ãƒ†ãƒ¼ã‚¸ã«é”ã—ã¦ã„ãªã„å ´åˆï¼ˆç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã§ãªã‘ã‚Œã°ï¼‰
            if (requiredStage && requiredStage > currentStage && !isAdminMode) {
                showLockedMessage(requiredStage);
                return;
            }
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‹ã‚‰ active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            document.getElementById(tabId).classList.add('active');
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ãƒœã‚¿ãƒ³ã« active ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            const activeTab = Array.from(tabs).find(tab => 
                tab.textContent.includes(getTabTitle(tabId))
            );
            if (activeTab && !activeTab.classList.contains('locked')) {
                activeTab.classList.add('active');
            }
            
            // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function getTabTitle(tabId) {
            const titles = {
                'overview': 'ç‰©ä»¶æ¦‚è¦',
                'simulation': 'åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                'valuation': 'ä¾¡æ ¼æŸ»å®š',
                'finance': 'èè³‡è¨ˆç”»',
                'summary': 'æŠ•è³‡åˆ¤æ–­',
                'documents': 'å¿…è¦æ›¸é¡'
            };
            return titles[tabId] || '';
        }
        
        function showLockedMessage(requiredStage) {
            const messages = {
                3: 'ä¾¡æ ¼æŸ»å®šåˆ†æã‚’ã”è¦§ã„ãŸã ãã«ã¯ã€è©³ç´°æ¤œè¨æ®µéšã¸ã®ç§»è¡ŒãŒå¿…è¦ã§ã™ã€‚',
                4: 'èè³‡è¨ˆç”»ã®è©³ç´°ã¯ã€å•†è«‡æ®µéšã§ã”æä¾›ã„ãŸã—ã¾ã™ã€‚',
                5: 'æœ€çµ‚è³‡æ–™ã¯ã€å¥‘ç´„å‰ã®æœ€çµ‚ç¢ºèªæ®µéšã§ã”æä¾›ã„ãŸã—ã¾ã™ã€‚'
            };
            
            alert(messages[requiredStage] || 'ã“ã®æƒ…å ±ã¯æ¬¡ã®æ®µéšã§ã”æä¾›ã„ãŸã—ã¾ã™ã€‚');
        }
        
        function requestUnlock(stage) {
            const actions = {
                3: 'ä¾¡æ ¼æŸ»å®šåˆ†æã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚æ‹…å½“è€…ã‚ˆã‚Šé€£çµ¡ã„ãŸã—ã¾ã™ã€‚',
                4: 'å•†è«‡ã®ãŠç”³ã—è¾¼ã¿ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚æ—¥ç¨‹èª¿æ•´ã®ã”é€£çµ¡ã‚’ã„ãŸã—ã¾ã™ã€‚',
                5: 'æœ€çµ‚æ¤œè¨æ®µéšã¸ã®ç§»è¡Œã‚’ç¢ºèªã—ã¾ã—ãŸã€‚å…¨è³‡æ–™ã‚’æº–å‚™ã„ãŸã—ã¾ã™ã€‚'
            };
            
            alert(actions[stage]);
            // å®Ÿéš›ã«ã¯ã“ã“ã§APIã‚³ãƒ¼ãƒ«ãªã©ã‚’è¡Œã†
        }
        
        function advanceStage() {
            if (currentStage < 5) {
                currentStage++;
                updateStageIndicator();
                unlockContent();
                alert(`ã‚¹ãƒ†ãƒ¼ã‚¸${currentStage}ã«é€²ã¿ã¾ã—ãŸã€‚æ–°ã—ã„æƒ…å ±ãŒã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚`);
            }
        }
        
        function updateStageIndicator() {
            // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            const stageItems = document.querySelectorAll('.stage-item');
            stageItems.forEach((item, index) => {
                if (index < currentStage - 1) {
                    item.classList.add('completed');
                    item.classList.remove('current');
                } else if (index === currentStage - 1) {
                    item.classList.add('current');
                    item.classList.remove('completed');
                } else {
                    item.classList.remove('completed', 'current');
                }
            });
            
            // ã‚¹ãƒ†ãƒ¼ã‚¸èª¬æ˜ã‚’æ›´æ–°
            const descriptions = {
                1: {
                    title: 'ã‚¹ãƒ†ãƒ¼ã‚¸1ï¼šåˆå›æ¥è§¦',
                    desc: 'ç‰©ä»¶ã®åŸºæœ¬æƒ…å ±ã‚’ã”ç¢ºèªã„ãŸã ãæ®µéšã§ã™ã€‚',
                    unlocked: 'ç‰©ä»¶æ¦‚è¦',
                    next: 'åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'
                },
                2: {
                    title: 'ã‚¹ãƒ†ãƒ¼ã‚¸2ï¼šé–¢å¿ƒè¡¨æ˜',
                    desc: 'ç‰©ä»¶æ¦‚è¦ã‚’ã”ç¢ºèªã„ãŸã ãã€ã‚ˆã‚Šè©³ç´°ãªåç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ã„ãŸã ã‘ã‚‹æ®µéšã§ã™ã€‚',
                    unlocked: 'ç‰©ä»¶æ¦‚è¦ã€åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                    next: 'ä¾¡æ ¼æŸ»å®šåˆ†æã€èè³‡è¨ˆç”»è©³ç´°'
                },
                3: {
                    title: 'ã‚¹ãƒ†ãƒ¼ã‚¸3ï¼šè©³ç´°æ¤œè¨',
                    desc: 'PRISMç‹¬è‡ªã®ä¾¡æ ¼æŸ»å®šåˆ†æã«ã‚ˆã‚Šã€æŠ•è³‡åˆ¤æ–­ã®ææ–™ã‚’ã”æä¾›ã—ã¾ã™ã€‚',
                    unlocked: 'ç‰©ä»¶æ¦‚è¦ã€åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¾¡æ ¼æŸ»å®š',
                    next: 'èè³‡è¨ˆç”»è©³ç´°ã€æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼'
                },
                4: {
                    title: 'ã‚¹ãƒ†ãƒ¼ã‚¸4ï¼šå•†è«‡',
                    desc: 'èè³‡è¨ˆç”»ã‚’å«ã‚€å…·ä½“çš„ãªæŠ•è³‡ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚',
                    unlocked: 'ç‰©ä»¶æ¦‚è¦ã€åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ä¾¡æ ¼æŸ»å®šã€èè³‡è¨ˆç”»',
                    next: 'æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼ã€å¥‘ç´„æ›¸é¡'
                },
                5: {
                    title: 'ã‚¹ãƒ†ãƒ¼ã‚¸5ï¼šæœ€çµ‚ç¢ºèª',
                    desc: 'å…¨ã¦ã®æƒ…å ±ã‚’é–‹ç¤ºã—ã€æœ€çµ‚çš„ãªæŠ•è³‡åˆ¤æ–­ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
                    unlocked: 'å…¨è³‡æ–™',
                    next: 'å¥‘ç´„æ‰‹ç¶šãã¸'
                }
            };
            
            const stageDesc = descriptions[currentStage];
            if (stageDesc) {
                document.querySelector('.stage-description').innerHTML = `
                    <h3>${stageDesc.title}</h3>
                    <p>${stageDesc.desc}</p>
                    <p style="margin-top: 10px;"><strong>ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ¸ˆã¿ï¼š</strong>${stageDesc.unlocked}</p>
                    <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§é–‹ç¤ºï¼š</strong>${stageDesc.next}</p>
                `;
            }
        }
        
        function unlockContent() {
            const tabs = document.querySelectorAll('.nav-tab');
            const unlockMap = {
                1: [0],              // ã‚¹ãƒ†ãƒ¼ã‚¸1: ç‰©ä»¶æ¦‚è¦ã®ã¿
                2: [0, 1],           // ã‚¹ãƒ†ãƒ¼ã‚¸2: ç‰©ä»¶æ¦‚è¦ã€åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                3: [0, 1, 2],        // ã‚¹ãƒ†ãƒ¼ã‚¸3: ï¼‹ä¾¡æ ¼æŸ»å®š
                4: [0, 1, 2, 3],     // ã‚¹ãƒ†ãƒ¼ã‚¸4: ï¼‹èè³‡è¨ˆç”»
                5: [0, 1, 2, 3, 4, 5] // ã‚¹ãƒ†ãƒ¼ã‚¸5: å…¨ã¦
            };
            
            tabs.forEach((tab, index) => {
                if ((unlockMap[currentStage] && unlockMap[currentStage].includes(index)) || isAdminMode) {
                    tab.classList.remove('locked');
                } else {
                    tab.classList.add('locked');
                }
            });
        }

        // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡æ›¿
        function toggleAdminMode() {
            isAdminMode = !isAdminMode;
            const adminPanel = document.getElementById('adminPanel');
            const adminOverlay = document.getElementById('adminOverlay');
            const adminBtn = document.getElementById('adminToggle');
            
            if (isAdminMode) {
                adminPanel.style.display = 'block';
                adminOverlay.style.display = 'block';
                adminBtn.style.background = 'var(--primary-light)';
                adminBtn.innerHTML = '<span class="material-icons" style="vertical-align: middle; margin-right: 5px; font-size: 18px;">settings</span>ç®¡ç†è€…ï¼ˆONï¼‰';
                unlockContent(); // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯å…¨ã‚¿ãƒ–ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
                
                // ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
                if (window.innerWidth <= 768) {
                    document.body.style.overflow = 'hidden';
                }
            } else {
                adminPanel.style.display = 'none';
                adminOverlay.style.display = 'none';
                adminBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                adminBtn.innerHTML = '<span class="material-icons" style="vertical-align: middle; margin-right: 5px; font-size: 18px;">settings</span>ç®¡ç†è€…';
                unlockContent(); // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™
                document.body.style.overflow = '';
            }
        }
        
        // ç®¡ç†è€…ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
        function closeAdminPanel() {
            isAdminMode = false;
            const adminPanel = document.getElementById('adminPanel');
            const adminOverlay = document.getElementById('adminOverlay');
            const adminBtn = document.getElementById('adminToggle');
            
            adminPanel.style.display = 'none';
            adminOverlay.style.display = 'none';
            adminBtn.style.background = 'rgba(255, 255, 255, 0.2)';
            adminBtn.innerHTML = '<span class="material-icons" style="vertical-align: middle; margin-right: 5px; font-size: 18px;">settings</span>ç®¡ç†è€…';
            unlockContent(); // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™
            document.body.style.overflow = '';
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¸è¨­å®šï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function setStage(stage) {
            currentStage = stage;
            updateStageIndicator();
            unlockContent();
            // loadStageContent(stage); // å‰Šé™¤: HTMLã«æ—¢ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹ãŸã‚ä¸è¦
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.stage-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.borderColor = 'var(--gray-200)';
                btn.style.color = 'inherit';
            });
            event.target.style.background = 'var(--primary-lighter)';
            event.target.style.borderColor = 'var(--primary-light)';
            event.target.style.color = 'var(--primary-dark)';
            
            // ç®¡ç†è€…æƒ…å ±ã‚’æ›´æ–°
            document.getElementById('currentStageInfo').textContent = `ã‚¹ãƒ†ãƒ¼ã‚¸${stage}`;
            
            // è©²å½“ã™ã‚‹ã‚¿ãƒ–ã‚’è¡¨ç¤º
            if (stage === 1) showTab('overview', 1);
            else if (stage === 2) showTab('simulation', 2);
            else if (stage >= 3) showTab('overview', 1);
        }
        
        // é¡§å®¢ã‚¿ã‚¤ãƒ—å¤‰æ›´ï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function changeCustomerType() {
            const customerType = document.getElementById('customerType').value;
            const customerNames = {
                'new': 'æ–°è¦é¡§å®¢ï¼ˆç”°ä¸­æ§˜ï¼‰',
                'interested': 'é–¢å¿ƒé¡§å®¢ï¼ˆéˆ´æœ¨æ§˜ï¼‰',
                'serious': 'æœ¬æ ¼æ¤œè¨ï¼ˆå±±ç”°æ§˜ï¼‰',
                'negotiating': 'å•†è«‡ä¸­ï¼ˆä½è—¤æ§˜ï¼‰',
                'closing': 'æˆç´„å‰ï¼ˆé«˜æ©‹æ§˜ï¼‰'
            };
            
            const stageMap = {
                'new': 1,
                'interested': 2,
                'serious': 3,
                'negotiating': 4,
                'closing': 5
            };
            
            document.getElementById('currentCustomer').textContent = customerNames[customerType];
            setStage(stageMap[customerType]);
        }
        
        // å…¨è³‡æ–™ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function unlockAll() {
            currentStage = 5;
            updateStageIndicator();
            unlockContent();
            // loadStageContent(5); // å‰Šé™¤: HTMLã«æ—¢ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹ãŸã‚ä¸è¦
            alert('å…¨ã¦ã®è³‡æ–™ãŒã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚');
            
            // UIæ›´æ–°
            document.getElementById('currentStageInfo').textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¸5';
            document.getElementById('customerType').value = 'closing';
            document.getElementById('currentCustomer').textContent = 'æˆç´„å‰ï¼ˆé«˜æ©‹æ§˜ï¼‰';
        }
        
        // ãƒªã‚»ãƒƒãƒˆï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function resetAll() {
            currentStage = 2;
            updateStageIndicator();
            unlockContent();
            // resetContent(); // å‰Šé™¤: HTMLã«æ—¢ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹ãŸã‚ä¸è¦
            showTab('overview', 1);
            document.getElementById('customerType').value = 'interested';
            document.getElementById('currentCustomer').textContent = 'é–¢å¿ƒé¡§å®¢ï¼ˆéˆ´æœ¨æ§˜ï¼‰';
            document.getElementById('currentStageInfo').textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¸2';
            alert('åˆæœŸçŠ¶æ…‹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸2ï¼‰ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª­ã¿è¾¼ã¿ï¼ˆå»ƒæ­¢ï¼šHTMLã«ç›´æ¥è¨˜è¼‰ï¼‰
        /* function loadStageContent(stage) {
            if (stage >= 3) {
                // ä¾¡æ ¼æŸ»å®šã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¦å®Ÿã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
                document.querySelector('#valuation .section-card').innerHTML = `
                    <h2 class="section-title">3. PRISMç‹¬è‡ªä¾¡æ ¼æŸ»å®šåˆ†æ</h2>
                    <h3 class="subsection-title">æŸ»å®šçµæœã‚µãƒãƒªãƒ¼</h3>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">å£²å‡ºä¾¡æ ¼</div>
                            <div class="kpi-value">6.8</div>
                            <div class="kpi-unit">å„„å††</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">PRISMæŸ»å®šä¾¡æ ¼</div>
                            <div class="kpi-value">7.2</div>
                            <div class="kpi-unit">å„„å††</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">ä¾¡æ ¼å¦¥å½“æ€§</div>
                            <div class="kpi-value" style="color: var(--success);">å„ªè‰¯</div>
                            <div class="kpi-unit">å‰²å®‰åˆ¤å®š</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">æŠ•è³‡æ¨å¥¨åº¦</div>
                            <div class="kpi-value">S</div>
                            <div class="kpi-unit">æœ€å„ªå…ˆæ¨å¥¨</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-black" onclick="advanceStage()">èè³‡è¨ˆç”»ã‚’ç¢ºèªã™ã‚‹</button>
                    </div>
                `;
            }
            
            if (stage >= 4) {
                // èè³‡è¨ˆç”»ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                document.querySelector('#finance .section-card').innerHTML = `
                    <h2 class="section-title">4. èè³‡è¨ˆç”»ãƒ»éŠ€è¡Œè©•ä¾¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                    <h3 class="subsection-title">æ¨å¥¨èè³‡ãƒ—ãƒ©ãƒ³</h3>
                    <div class="property-overview">
                        <div class="info-box">
                            <h4>èè³‡é‡‘é¡</h4>
                            <span class="highlight-number">5.1å„„å††</span>
                            <p>èè³‡æ¯”ç‡ï¼š75%</p>
                        </div>
                        <div class="info-box">
                            <h4>è‡ªå·±è³‡é‡‘</h4>
                            <span class="highlight-number">1.8å„„å††</span>
                            <p>é ­é‡‘ï¼‹è«¸è²»ç”¨</p>
                        </div>
                        <div class="info-box">
                            <h4>æƒ³å®šé‡‘åˆ©</h4>
                            <span class="highlight-number">1.2%</span>
                            <p>å¤‰å‹•é‡‘åˆ©ï¼ˆå„ªé‡é©ç”¨ï¼‰</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-black" onclick="advanceStage()">æœ€çµ‚ç¢ºèªã¸é€²ã‚€</button>
                    </div>
                `;
            }
            
            if (stage >= 5) {
                // æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                document.querySelector('#summary .section-card').innerHTML = `
                    <h2 class="section-title">5. æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼</h2>
                    <div style="background: var(--primary-lighter); padding: 30px; text-align: center; margin: 20px 0;">
                        <h2 style="color: var(--primary-dark); margin-bottom: 20px;">PRISMæŠ•è³‡æ¨å¥¨åº¦</h2>
                        <span style="font-size: 4em; color: var(--primary-dark); font-weight: bold;">S</span>
                        <p style="margin-top: 10px; font-size: 1.2em;">æœ€å„ªå…ˆæ¨å¥¨</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-black" onclick="requestConsultation()">LINEã§å¥‘ç´„ç›¸è«‡</button>
                    </div>
                `;
                
                // å¿…è¦æ›¸é¡ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                document.querySelector('#documents .section-card').innerHTML = `
                    <h2 class="section-title">6. ã”æä¾›è³‡æ–™ä¸€è¦§</h2>
                    <h3 class="subsection-title">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½è³‡æ–™</h3>
                    <div style="background: var(--gray-50); padding: 30px;">
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: 10px 0; border-bottom: 1px solid var(--gray-100); position: relative; padding-left: 35px;">
                                <span style="position: absolute; left: 0; color: var(--success); font-weight: bold; font-size: 1.2em;">âœ“</span>
                                ç‰©ä»¶æ¦‚è¦æ›¸ï¼ˆè©³ç´°ç‰ˆï¼‰
                            </li>
                            <li style="padding: 10px 0; border-bottom: 1px solid var(--gray-100); position: relative; padding-left: 35px;">
                                <span style="position: absolute; left: 0; color: var(--success); font-weight: bold; font-size: 1.2em;">âœ“</span>
                                PRISMä¾¡å€¤è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ30ãƒšãƒ¼ã‚¸ï¼‰
                            </li>
                            <li style="padding: 10px 0; border-bottom: 1px solid var(--gray-100); position: relative; padding-left: 35px;">
                                <span style="position: absolute; left: 0; color: var(--success); font-weight: bold; font-size: 1.2em;">âœ“</span>
                                10å¹´é–“åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆExcelï¼‰
                            </li>
                            <li style="padding: 10px 0; border-bottom: 1px solid var(--gray-100); position: relative; padding-left: 35px;">
                                <span style="position: absolute; left: 0; color: var(--success); font-weight: bold; font-size: 1.2em;">âœ“</span>
                                é‡è¦äº‹é …èª¬æ˜æ›¸ï¼ˆæ¡ˆï¼‰
                            </li>
                            <li style="padding: 10px 0; position: relative; padding-left: 35px;">
                                <span style="position: absolute; left: 0; color: var(--success); font-weight: bold; font-size: 1.2em;">âœ“</span>
                                å£²è²·å¥‘ç´„æ›¸ï¼ˆæ¡ˆï¼‰
                            </li>
                        </ul>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-black" onclick="alert('è³‡æ–™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ')">å…¨è³‡æ–™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                `;
            }
        } */

        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªã‚»ãƒƒãƒˆï¼ˆå»ƒæ­¢ï¼šHTMLã«ç›´æ¥è¨˜è¼‰ï¼‰
        /* function resetContent() {
            // ãƒ­ãƒƒã‚¯ç”»é¢ã‚’å†è¨­å®š
            document.querySelector('#valuation .section-card').innerHTML = `
                <div class="locked-overlay">
                    <div class="locked-content">
                        <div class="locked-icon">ğŸ”’</div>
                        <h2 class="locked-title">ä¾¡æ ¼æŸ»å®šåˆ†æ</h2>
                        <p class="locked-description">
                            PRISMç‹¬è‡ªã®3æ‰‹æ³•ã«ã‚ˆã‚‹è©³ç´°ãªä¾¡æ ¼æŸ»å®šåˆ†æã‚’ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚<br>
                            ã‚¨ãƒªã‚¢ç›¸å ´ã¨ã®æ¯”è¼ƒã€æŠ•è³‡å¦¥å½“æ€§ã®åˆ¤å®šçµæœã‚’å«ã¿ã¾ã™ã€‚
                        </p>
                        <button class="unlock-button" onclick="requestUnlock(3)">
                            ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã‚’ç”³è«‹ã™ã‚‹
                        </button>
                    </div>
                </div>
            `;
            document.querySelector('#finance .section-card').innerHTML = `
                <div class="locked-overlay">
                    <div class="locked-content">
                        <div class="locked-icon">ğŸ”’</div>
                        <h2 class="locked-title">èè³‡è¨ˆç”»è©³ç´°</h2>
                        <p class="locked-description">
                            ææºé‡‘èæ©Ÿé–¢ã®èè³‡æ¡ä»¶ã€å¿…è¦å±æ€§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€<br>
                            éŠ€è¡Œè©•ä¾¡é¡äºˆæ¸¬ãªã©ã€èè³‡å®Ÿç¾ã«å‘ã‘ãŸè©³ç´°æƒ…å ±ã‚’ã”æä¾›ã—ã¾ã™ã€‚
                        </p>
                        <button class="unlock-button" onclick="requestUnlock(4)">
                            å•†è«‡ã‚’ç”³ã—è¾¼ã‚€
                        </button>
                    </div>
                </div>
            `;
            document.querySelector('#summary .section-card').innerHTML = `
                <div class="locked-overlay">
                    <div class="locked-content">
                        <div class="locked-icon">ğŸ”’</div>
                        <h2 class="locked-title">æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼</h2>
                        <p class="locked-description">
                            ç·åˆè©•ä¾¡ã€ãƒªã‚¹ã‚¯åˆ†æã€æŠ•è³‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç­‰ã€<br>
                            æœ€çµ‚çš„ãªæŠ•è³‡åˆ¤æ–­ã«å¿…è¦ãªå…¨æƒ…å ±ã‚’çµ±åˆã—ãŸãƒ¬ãƒãƒ¼ãƒˆã§ã™ã€‚
                        </p>
                        <button class="unlock-button" onclick="requestUnlock(5)">
                            æœ€çµ‚æ¤œè¨æ®µéšã¸é€²ã‚€
                        </button>
                    </div>
                </div>
            `;
            document.querySelector('#documents .section-card').innerHTML = `
                <div class="locked-overlay">
                    <div class="locked-content">
                        <div class="locked-icon">ğŸ”’</div>
                        <h2 class="locked-title">å¥‘ç´„é–¢é€£æ›¸é¡ä¸€å¼</h2>
                        <p class="locked-description">
                            é‡è¦äº‹é …èª¬æ˜æ›¸ã€å£²è²·å¥‘ç´„æ›¸æ¡ˆã€ç™»è¨˜é–¢é€£æ›¸é¡ç­‰ã€<br>
                            å¥‘ç´„ã«å¿…è¦ãªå…¨ã¦ã®æ›¸é¡ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã„ãŸã ã‘ã¾ã™ã€‚
                        </p>
                        <button class="unlock-button" onclick="requestUnlock(5)">
                            å¥‘ç´„æº–å‚™ã‚’é–‹å§‹ã™ã‚‹
                        </button>
                    </div>
                </div>
            `;
        } */

        function requestConsultation() {
            window.open('https://line.me/ti/p/@prism', '_blank');
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
        function logout() {
            sessionStorage.removeItem('prism_user');
            window.location.href = '/';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
            const user = JSON.parse(sessionStorage.getItem('prism_user') || '{}');
            if (user.name) {
                document.getElementById('memberName').textContent = user.name;
            }

            // åˆæœŸçŠ¶æ…‹è¨­å®šï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸5ã§å…¨è³‡æ–™é–‹æ”¾ï¼‰
            currentStage = 5;
            updateStageIndicator();
            unlockContent();
            
            // ç®¡ç†è€…ãƒ‘ãƒãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’æ›´æ–°
            document.getElementById('customerType').value = 'closing';
            document.getElementById('currentCustomer').textContent = 'æˆç´„å‰ï¼ˆé«˜æ©‹æ§˜ï¼‰';
            document.getElementById('currentStageInfo').textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¸5';
        });

        // PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆVercel APIçµŒç”±ï¼‰
        async function downloadPDF(docType = 'complete') {
            // ãƒœã‚¿ãƒ³ã‚’å–å¾—
            const button = event.currentTarget || event.target.closest('button');
            const originalContent = button.innerHTML;
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            button.innerHTML = `
                <span class="material-icons" style="animation: spin 1s linear infinite; margin-right: 8px;">sync</span>
                PDFç”Ÿæˆä¸­...
            `;
            button.disabled = true;
            
            try {
                // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£IDã‚’å–å¾—
                const propertyId = '001';
                const stage = currentStage || 5;
                
                // PDFç”ŸæˆAPIã‚’å‘¼ã³å‡ºã—
                const params = new URLSearchParams({
                    propertyId: propertyId,
                    docType: docType,
                    stage: stage,
                    forceRegenerate: false  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
                });
                
                const response = await fetch(`https://prism-vip.vercel.app/api/generate-pdf?${params}`);
                
                if (response.ok) {
                    // PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_${docType === 'complete' ? 'å®Œå…¨æŠ•è³‡ãƒ¬ãƒãƒ¼ãƒˆ' : docType}_PRISM.pdf`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                    // alert('PDFã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ');
                } else {
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚µãƒ³ãƒ—ãƒ«PDFã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    console.error('PDF generation failed, using sample PDF');
                    const link = document.createElement('a');
                    link.href = '/report_sample/å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_å®Œå…¨æŠ•è³‡ãƒ¬ãƒãƒ¼ãƒˆ_PRISM.pdf';
                    link.download = 'å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_å®Œå…¨æŠ•è³‡ãƒ¬ãƒãƒ¼ãƒˆ_PRISM.pdf';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            } catch (error) {
                console.error('PDF download error:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚µãƒ³ãƒ—ãƒ«PDFã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                const link = document.createElement('a');
                link.href = '/report_sample/å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_å®Œå…¨æŠ•è³‡ãƒ¬ãƒãƒ¼ãƒˆ_PRISM.pdf';
                link.download = 'å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_å®Œå…¨æŠ•è³‡ãƒ¬ãƒãƒ¼ãƒˆ_PRISM.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } finally {
                // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                button.innerHTML = originalContent;
                button.disabled = false;
            }
        }

        // å€‹åˆ¥è³‡æ–™ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        async function downloadDocument(documentType) {
            const button = event.currentTarget || event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="material-icons" style="animation: spin 1s linear infinite; margin-right: 8px; font-size: 16px;">sync</span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...';
            button.disabled = true;
            
            try {
                // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæ—¥æœ¬èªå¯¾å¿œç‰ˆï¼‰
                const response = await fetch(`/api/download-document-v2?type=${documentType}`);
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    const blob = await response.blob();
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ±ºå®š
                    const fileExtension = contentType.includes('excel') || contentType.includes('spreadsheet') ? 'xlsx' : 'pdf';
                    const documentNames = {
                        'property-overview': 'ç‰©ä»¶æ¦‚è¦æ›¸_è©³ç´°ç‰ˆ',
                        'cashflow-simulation': '10å¹´é–“åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                        'loan-simulation': 'èè³‡ææ¡ˆæ›¸_25å¹´è¿”æ¸ˆè¨ˆç”»',
                        'important-matters': 'é‡è¦äº‹é …èª¬æ˜æ›¸æ¡ˆ',
                        'sales-contract': 'å£²è²·å¥‘ç´„æ›¸æ¡ˆ'
                    };
                    
                    const fileName = `å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_${documentNames[documentType] || documentType}.${fileExtension}`;
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    // æˆåŠŸé€šçŸ¥
                    const messages = {
                        'property-overview': 'ç‰©ä»¶æ¦‚è¦æ›¸ï¼ˆè©³ç´°ç‰ˆï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ',
                        'cashflow-simulation': '10å¹´é–“åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆExcelï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ',
                        'loan-simulation': 'èè³‡ææ¡ˆæ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ',
                        'important-matters': 'é‡è¦äº‹é …èª¬æ˜æ›¸ï¼ˆæ¡ˆï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ',
                        'sales-contract': 'å£²è²·å¥‘ç´„æ›¸ï¼ˆæ¡ˆï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ'
                    };
                    
                    alert(messages[documentType] || 'ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                } else {
                    throw new Error('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Download error:', error);
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãçµŒã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        async function downloadAllDocuments() {
            const button = event.currentTarget || event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="material-icons" style="animation: spin 1s linear infinite; margin-right: 8px; font-size: 20px;">sync</span>ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...';
            button.disabled = true;
            
            const documentTypes = [
                'complete',  // PRISMä¾¡å€¤è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ
                'property-overview',
                'cashflow-simulation',
                'loan-simulation',
                'important-matters',
                'sales-contract'
            ];
            
            let successCount = 0;
            let failCount = 0;
            
            for (const type of documentTypes) {
                try {
                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’è»½æ¸›
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    if (type === 'complete') {
                        // PRISMä¾¡å€¤è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        await downloadPDF('complete');
                        successCount++;
                    } else {
                        // ãã®ä»–ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæ—¥æœ¬èªå¯¾å¿œç‰ˆAPIï¼‰
                        const response = await fetch(`/api/download-document-v2?type=${type}`);
                        if (response.ok) {
                            const contentType = response.headers.get('content-type');
                            const blob = await response.blob();
                            const fileExtension = contentType.includes('excel') || contentType.includes('spreadsheet') ? 'xlsx' : 'pdf';
                            const fileName = `å—é’å±±ãƒ—ãƒªã‚ºãƒ ãƒ“ãƒ«_${type}.${fileExtension}`;
                            
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = fileName;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                            
                            successCount++;
                        } else {
                            failCount++;
                        }
                    }
                } catch (error) {
                    console.error(`Failed to download ${type}:`, error);
                    failCount++;
                }
            }
            
            button.innerHTML = originalText;
            button.disabled = false;
            
            if (successCount === documentTypes.length) {
                alert(`å…¨è³‡æ–™ï¼ˆ${successCount}ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nâ€¢ PRISMä¾¡å€¤è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆPDFï¼‰\nâ€¢ ç‰©ä»¶æ¦‚è¦æ›¸è©³ç´°ç‰ˆï¼ˆPDFï¼‰\nâ€¢ 10å¹´é–“åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆExcelï¼‰\nâ€¢ èè³‡ææ¡ˆæ›¸25å¹´è¨ˆç”»ï¼ˆPDFï¼‰\nâ€¢ é‡è¦äº‹é …èª¬æ˜æ›¸æ¡ˆï¼ˆPDFï¼‰\nâ€¢ å£²è²·å¥‘ç´„æ›¸æ¡ˆï¼ˆPDFï¼‰`);
            } else if (failCount > 0) {
                alert(`ä¸€éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\næˆåŠŸ: ${successCount}ãƒ•ã‚¡ã‚¤ãƒ«\nå¤±æ•—: ${failCount}ãƒ•ã‚¡ã‚¤ãƒ«\n\nå†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚`);
            }
        }
    </script>
</body>
</html>